<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"godleon.github.io","root":"/blog/","scheme":"Muse","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false};
  </script>

  <meta name="description" content="此文章記錄學習 RHCE RH124 所留下的內容，此篇包含 RH124 chapter 4~6，分別是 &#39;Creating, Viewing, and Editing Text Files&#39;, &#39;Chapter 5. Managing Local Linux Users and Groups&#39;, 以及 &#39;Controlling Access to Files with Linux File Sy">
<meta property="og:type" content="article">
<meta property="og:title" content="[RHCE] RH124 Chapter 4~6 學習筆記">
<meta property="og:url" content="https://godleon.github.io/blog/RHCE/RHCE7-RH124-LearningNotes-CH04_06/index.html">
<meta property="og:site_name" content="小信豬的原始部落">
<meta property="og:description" content="此文章記錄學習 RHCE RH124 所留下的內容，此篇包含 RH124 chapter 4~6，分別是 &#39;Creating, Viewing, and Editing Text Files&#39;, &#39;Chapter 5. Managing Local Linux Users and Groups&#39;, 以及 &#39;Controlling Access to Files with Linux File Sy">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/7/70/Stdstreams-notitle.svg">
<meta property="og:image" content="http://cs.ucla.edu/classes/fall08/cs111/scribe/4/FDT_diagram.JPG">
<meta property="og:image" content="http://civilnet.cn/book/kernel/GNU.Linux.Application.Programming/images/11.1_0.jpg">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Tee.svg/400px-Tee.svg.png">
<meta property="og:image" content="https://lh3.googleusercontent.com/2bDqeWVGlV0vGtV0lm6TE-1KwHmNixd6pUAaDGh30pcFJGF3tI3WUsV6dxUzdRbSPh7dR3mzznf_EdinGaKeWQA1xrA9cdOJFajn-jQFCcgEfni4Sdpn4zd-6R4T-Rj0Cezry17a0m_hI61F1nD8TjQFomv6NltRNseZgPgHVM1JU0or0xr8Y322N7MfhzoQIXeLQgQMLTsKtLAr19avk7A3yUQiZn5m6RI6T0rVqmW2FsXYwGEiQiDQlmg9POKDIndNH9LknDoIGHK5PAL_03cmbuY5EdouDrBMQu1PCESLO5GvZgzG-UIWNXMYk692Rai3Cpw6zNbyMUdwqpzvUaCgsPFHYcRfA9C3U1VJ4p-O2Q9iIKq5-8DWzEzGb7HELfYNwAHny8QGnXBGnHa7qtzVUJseFngyW3I2T-rCD7rriDbNYep4-V_fSqMSCNFSpVcs6Xnaj9TmnmXoegWDt3p43VTQxqPPb5C1LpyOK8mwwzFJdrYEjRJNmRzz6o4tUTqfbeay_UdKTzARA4MrsP6k2X5wHPWlDOao9eh7cMtRsyQpk9KE3Mp2l44mIHs_tuIE=w657-h235-no">
<meta property="article:published_time" content="2016-04-03T08:45:00.000Z">
<meta property="article:modified_time" content="2023-07-14T08:10:30.478Z">
<meta property="article:author" content="godleon">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="RHCE">
<meta property="article:tag" content="RH124">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/7/70/Stdstreams-notitle.svg">


<link rel="canonical" href="https://godleon.github.io/blog/RHCE/RHCE7-RH124-LearningNotes-CH04_06/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>[RHCE] RH124 Chapter 4~6 學習筆記 | 小信豬的原始部落</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-703592-7"></script>
    <script data-pjax>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-703592-7');
      }
    </script>






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">小信豬的原始部落</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter-4-Creating-Viewing-and-Editing-Text-Files"><span class="nav-number">1.</span> <span class="nav-text">Chapter 4. Creating, Viewing, and Editing Text Files</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-Redirecting-Output-to-a-File-or-Program"><span class="nav-number">1.1.</span> <span class="nav-text">4.1 Redirecting Output to a File or Program</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Standard-input-standard-output-and-standard-error"><span class="nav-number">1.1.1.</span> <span class="nav-text">Standard input, standard output, and standard error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redirecting-output-to-a-file"><span class="nav-number">1.1.2.</span> <span class="nav-text">Redirecting output to a file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Constructing-pipelines"><span class="nav-number">1.1.3.</span> <span class="nav-text">Constructing pipelines</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tee"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">tee</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter-5-Managing-Local-Linux-Users-and-Groups"><span class="nav-number">2.</span> <span class="nav-text">Chapter 5. Managing Local Linux Users and Groups</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-Users-and-Groups"><span class="nav-number">2.1.</span> <span class="nav-text">5.1 Users and Groups</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#What-is-a-user"><span class="nav-number">2.1.1.</span> <span class="nav-text">What is a user?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#What-is-a-group"><span class="nav-number">2.1.2.</span> <span class="nav-text">What is a group?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-Gaining-Superuser-Access"><span class="nav-number">2.2.</span> <span class="nav-text">5.2 Gaining Superuser Access</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#The-root-user"><span class="nav-number">2.2.1.</span> <span class="nav-text">The root user</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Switching-users-with-su"><span class="nav-number">2.2.2.</span> <span class="nav-text">Switching users with su</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Running-commands-as-root-with-sudo"><span class="nav-number">2.2.3.</span> <span class="nav-text">Running commands as root with sudo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A3%9C%E5%85%85"><span class="nav-number">2.2.4.</span> <span class="nav-text">補充</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-Managing-Local-User-Accounts"><span class="nav-number">2.3.</span> <span class="nav-text">5.3 Managing Local User Accounts</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Managing-local-users"><span class="nav-number">2.3.1.</span> <span class="nav-text">Managing local users</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#usermode-modifies-existing-users"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">usermode modifies existing users</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#userdel-deletes-users"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">userdel deletes users</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#id-displays-user-information"><span class="nav-number">2.3.1.3.</span> <span class="nav-text">id displays user information</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UID-ranges"><span class="nav-number">2.3.1.4.</span> <span class="nav-text">UID ranges</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Practice"><span class="nav-number">2.3.2.</span> <span class="nav-text">Practice</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-Managing-Local-Group-Accounts"><span class="nav-number">2.4.</span> <span class="nav-text">5.4 Managing Local Group Accounts</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-1-Managing-supplementary-groups"><span class="nav-number">2.4.1.</span> <span class="nav-text">5.4.1 Managing supplementary groups</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#groupadd"><span class="nav-number">2.4.1.1.</span> <span class="nav-text">groupadd</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#groupmod"><span class="nav-number">2.4.1.2.</span> <span class="nav-text">groupmod</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#usermod-alters-group-membership"><span class="nav-number">2.4.1.3.</span> <span class="nav-text">usermod alters group membership</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-Managing-User-Passwords"><span class="nav-number">2.5.</span> <span class="nav-text">5.5 Managing User Passwords</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-1-Shadow-passwords-and-password-policy"><span class="nav-number">2.5.1.</span> <span class="nav-text">5.5.1 Shadow passwords and password policy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-2-Password-aging"><span class="nav-number">2.5.2.</span> <span class="nav-text">5.5.2 Password aging</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-3-Restricting-access"><span class="nav-number">2.5.3.</span> <span class="nav-text">5.5.3 Restricting access</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-4-Lab-Managing-Local-Linux-Users-and-Groups"><span class="nav-number">2.5.4.</span> <span class="nav-text">5.5.4 Lab: Managing Local Linux Users and Groups</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-6-Practice-Managing-User-Password-Aging"><span class="nav-number">2.6.</span> <span class="nav-text">5.6 Practice: Managing User Password Aging</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter-6-Controlling-Access-to-Files-with-Linux-File-System-Permissions"><span class="nav-number">3.</span> <span class="nav-text">Chapter 6. Controlling Access to Files with Linux File System Permissions</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-Linux-File-System-Permissions"><span class="nav-number">3.1.</span> <span class="nav-text">6.1 Linux File System Permissions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-1-Linux-file-system-permissions"><span class="nav-number">3.1.1.</span> <span class="nav-text">6.1.1 Linux file system permissions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-2-Viewing-file-directory-permissions-and-ownership"><span class="nav-number">3.1.2.</span> <span class="nav-text">6.1.2 Viewing file&#x2F;directory permissions and ownership</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-Managing-File-System-Permissions-from-the-Command-Line"><span class="nav-number">3.2.</span> <span class="nav-text">6.2 Managing File System Permissions from the Command Line</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-1-Changing-file-directory-permissions"><span class="nav-number">3.2.1.</span> <span class="nav-text">6.2.1 Changing file&#x2F;directory permissions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-2-Changing-file-directory-user-or-group-ownership"><span class="nav-number">3.2.2.</span> <span class="nav-text">6.2.2 Changing file&#x2F;directory user or group ownership</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-Managing-Default-Permissions-and-File-Access"><span class="nav-number">3.3.</span> <span class="nav-text">6.3 Managing Default Permissions and File Access</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-1-Special-permissions"><span class="nav-number">3.3.1.</span> <span class="nav-text">6.3.1 Special permissions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SetUID"><span class="nav-number">3.3.1.1.</span> <span class="nav-text">SetUID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SetGID"><span class="nav-number">3.3.1.2.</span> <span class="nav-text">SetGID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Sticky-Bit"><span class="nav-number">3.3.1.3.</span> <span class="nav-text">Sticky Bit</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-2-Default-file-permissions"><span class="nav-number">3.3.2.</span> <span class="nav-text">6.3.2 Default file permissions</span></a></li></ol></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">godleon</p>
  <div class="site-description" itemprop="description">把時間花在哪裡，成就就在哪裡</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives">
          <span class="site-state-item-count">174</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
        <span class="site-state-item-count">124</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://godleon.github.io/blog/RHCE/RHCE7-RH124-LearningNotes-CH04_06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="godleon">
      <meta itemprop="description" content="把時間花在哪裡，成就就在哪裡">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小信豬的原始部落">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [RHCE] RH124 Chapter 4~6 學習筆記
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-04-03 16:45:00" itemprop="dateCreated datePublished" datetime="2016-04-03T16:45:00+08:00">2016-04-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-07-14 16:10:30" itemprop="dateModified" datetime="2023-07-14T16:10:30+08:00">2023-07-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/RHCE/" itemprop="url" rel="index"><span itemprop="name">RHCE</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/blog/RHCE/RHCE7-RH124-LearningNotes-CH04_06/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="RHCE/RHCE7-RH124-LearningNotes-CH04_06/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <div class="post-description">此文章記錄學習 RHCE RH124 所留下的內容，此篇包含 RH124 chapter 4~6，分別是 'Creating, Viewing, and Editing Text Files', 'Chapter 5. Managing Local Linux Users and Groups', 以及 'Controlling Access to Files with Linux File System Permissions'</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Chapter-4-Creating-Viewing-and-Editing-Text-Files"><a href="#Chapter-4-Creating-Viewing-and-Editing-Text-Files" class="headerlink" title="Chapter 4. Creating, Viewing, and Editing Text Files"></a>Chapter 4. Creating, Viewing, and Editing Text Files</h1><h2 id="4-1-Redirecting-Output-to-a-File-or-Program"><a href="#4-1-Redirecting-Output-to-a-File-or-Program" class="headerlink" title="4.1 Redirecting Output to a File or Program"></a>4.1 Redirecting Output to a File or Program</h2><h3 id="Standard-input-standard-output-and-standard-error"><a href="#Standard-input-standard-output-and-standard-error" class="headerlink" title="Standard input, standard output, and standard error"></a>Standard input, standard output, and standard error</h3><p><img src="https://upload.wikimedia.org/wikipedia/commons/7/70/Stdstreams-notitle.svg" alt="Process I/O Channel"></p>
<p><img src="http://cs.ucla.edu/classes/fall08/cs111/scribe/4/FDT_diagram.JPG" alt="STDIN、STDOUT &amp; STDERR"></p>
<h3 id="Redirecting-output-to-a-file"><a href="#Redirecting-output-to-a-file" class="headerlink" title="Redirecting output to a file"></a>Redirecting output to a file</h3><table>
<thead>
<tr>
<th>Usage</th>
<th>說明</th>
</tr>
</thead>
<tbody><tr>
<td><code>&amp;&gt;file</code></td>
<td>stdout &amp; stderr 各自輸出到相同的檔案中<br />會複寫指定檔案，若檔案不存在則建立新檔</td>
</tr>
<tr>
<td><code>&gt;&gt;file 2&gt;&amp;1</code><p /><code>&amp;&gt;&gt;file</code></td>
<td>stderr 會導向變成 stdout 輸出，並附加內容於指定檔案<br /><strong><font color='red'>不會再有 stderr 輸出，而是全部皆為 stdout 輸出</font></strong></td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@server tmp]$ find /etc -name passwd &amp;&gt;/tmp/save-both</span><br><span class="line">[vagrant@server tmp]$ <span class="built_in">cat</span> /tmp/save-both</span><br><span class="line">....</span><br><span class="line">find: ‘/etc/lvm/backup’: Permission denied</span><br><span class="line">find: ‘/etc/lvm/cache’: Permission denied</span><br><span class="line">/etc/passwd</span><br><span class="line">find: ‘/etc/polkit-1/rules.d’: Permission denied</span><br><span class="line">find: ‘/etc/polkit-1/localauthority’: Permission denied</span><br><span class="line">....</span><br><span class="line">/etc/pam.d/passwd</span><br><span class="line">find: ‘/etc/audisp’: Permission denied</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<h3 id="Constructing-pipelines"><a href="#Constructing-pipelines" class="headerlink" title="Constructing pipelines"></a>Constructing pipelines</h3><p>pipeline 並沒有對 stderr 進行處理，透過以下兩個指令可以看出差別：(看有顏色的部分)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 僅有 stdout 的內容會被篩選</span></span><br><span class="line">[vagrant@server tmp]$ find /etc -name passwd | grep etc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 連同 stderr 的內容都會被篩選(因為 stderr 的內容已經導向 stdout 輸出)</span></span><br><span class="line">[vagrant@server tmp]$ find /etc -name passwd 2&gt;&amp;1 | grep etc</span><br></pre></td></tr></table></figure>

<p><img src="http://civilnet.cn/book/kernel/GNU.Linux.Application.Programming/images/11.1_0.jpg" alt="Linux Pipeline"></p>
<h4 id="tee"><a href="#tee" class="headerlink" title="tee"></a>tee</h4><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Tee.svg/400px-Tee.svg.png" alt="tee pipeline"></p>
<p>tee 的使用範例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -a = append</span></span><br><span class="line">[vagrant@server ~]$ ps -f | <span class="built_in">tee</span> -a ps_file.txt</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">vagrant   3372  3371  0 14:25 pts/0    00:00:00 -bash</span><br><span class="line">vagrant   3395  3372  0 14:25 pts/0    00:00:00 ps -f</span><br><span class="line">vagrant   3396  3372  0 14:25 pts/0    00:00:00 <span class="built_in">tee</span> -a ps_file.txt</span><br><span class="line"></span><br><span class="line">[vagrant@server ~]$ <span class="built_in">cat</span> ps_file.txt</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">vagrant   3372  3371  0 14:25 pts/0    00:00:00 -bash</span><br><span class="line">vagrant   3395  3372  0 14:25 pts/0    00:00:00 ps -f</span><br><span class="line">vagrant   3396  3372  0 14:25 pts/0    00:00:00 <span class="built_in">tee</span> -a ps_file.txt</span><br></pre></td></tr></table></figure>

<p>以下兩種寄 mail 的方式相同：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> filename | mail -s subject username</span><br><span class="line"></span><br><span class="line">$ mail -s subject username &lt; filename</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="Chapter-5-Managing-Local-Linux-Users-and-Groups"><a href="#Chapter-5-Managing-Local-Linux-Users-and-Groups" class="headerlink" title="Chapter 5. Managing Local Linux Users and Groups"></a>Chapter 5. Managing Local Linux Users and Groups</h1><h2 id="5-1-Users-and-Groups"><a href="#5-1-Users-and-Groups" class="headerlink" title="5.1 Users and Groups"></a>5.1 Users and Groups</h2><h3 id="What-is-a-user"><a href="#What-is-a-user" class="headerlink" title="What is a user?"></a>What is a user?</h3><p><code>id</code> 用來顯示目前登入的使用者資訊：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@server ~]$ <span class="built_in">id</span></span><br><span class="line">uid=1000(vagrant) gid=1000(vagrant) <span class="built_in">groups</span>=1000(vagrant),10(wheel) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br></pre></td></tr></table></figure>
<blockquote>
<p>context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 是 SELinux 安全脈絡標籤</p>
</blockquote>
<p><strong><font color='red'>/etc/passwd</font></strong> 的格式可以參考 <code>man 5 passwd</code></p>
<p>基本上 password 的部分已經都用 x 取代，並移到 <strong><font color='red'>/etc/shadow</font></strong> 存放</p>
<h3 id="What-is-a-group"><a href="#What-is-a-group" class="headerlink" title="What is a group?"></a>What is a group?</h3><ol>
<li><p>每個使用者只會有一個 primary group，記錄在 <code>/etc/passwd</code> 內</p>
</li>
<li><p>每個使用者可以有 0 到多個 supplementary group，資訊會記錄在 <code>/etc/group</code> 內</p>
</li>
</ol>
<h2 id="5-2-Gaining-Superuser-Access"><a href="#5-2-Gaining-Superuser-Access" class="headerlink" title="5.2 Gaining Superuser Access"></a>5.2 Gaining Superuser Access</h2><h3 id="The-root-user"><a href="#The-root-user" class="headerlink" title="The root user"></a>The root user</h3><p>一般使用者可透過 <code>su</code>, <code>sudo</code>, <code>PolicyKit</code>(GUI 內用，類似 Windows UAC) 來取得 root 權限</p>
<h3 id="Switching-users-with-su"><a href="#Switching-users-with-su" class="headerlink" title="Switching users with su"></a>Switching users with su</h3><p><code>su [-] username</code>：等同於新的 user 重新登入的效果</p>
<p><code>su username</code>：產生新的 shell 並使用目前的環境變數</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 -c 可達到類似 windows runas 的效果</span></span><br><span class="line">[vagrant@server ~]$ su -c <span class="string">&quot;ls /root&quot;</span> root</span><br><span class="line">Password:</span><br><span class="line">anaconda-ks.cfg</span><br></pre></td></tr></table></figure>

<h3 id="Running-commands-as-root-with-sudo"><a href="#Running-commands-as-root-with-sudo" class="headerlink" title="Running commands as root with sudo"></a>Running commands as root with sudo</h3><p>su 的缺點是，一次就拿到完整的 root 權限，且切換成 root 還必須知道 root 的密碼。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@server ~]$ sudo <span class="built_in">cat</span> /etc/sudoers | grep <span class="string">&#x27;^[^#]&#x27;</span></span><br><span class="line">Defaults   !visiblepw</span><br><span class="line">Defaults    always_set_home</span><br><span class="line">Defaults    env_reset</span><br><span class="line">Defaults    env_keep =  <span class="string">&quot;COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS&quot;</span></span><br><span class="line">Defaults    env_keep += <span class="string">&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;</span></span><br><span class="line">Defaults    env_keep += <span class="string">&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;</span></span><br><span class="line">Defaults    env_keep += <span class="string">&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;</span></span><br><span class="line">Defaults    env_keep += <span class="string">&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;</span></span><br><span class="line">Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">root    ALL=(ALL)       ALL</span><br><span class="line">%wheel  ALL=(ALL)       ALL   <span class="comment">#表示 wheel 群組內的擁有所有權限(% 開頭表示指定群組)</span></span><br><span class="line"></span><br><span class="line">[vagrant@server ~]$ <span class="built_in">cat</span> /etc/group | grep wheel</span><br><span class="line">wheel:x:10:vagrant</span><br></pre></td></tr></table></figure>

<p>使用 <code>sudo</code> 的特點：</p>
<ol>
<li><p>執行 root 的系統命令不需要記住 root 密碼</p>
</li>
<li><p>所有 sudo 所執行的紀錄都會留在 <code>/var/log/secure</code> 中</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@server ~]$ sudo <span class="built_in">tail</span> /var/log/secure</span><br><span class="line">....</span><br><span class="line">Feb 22 13:45:26 localhost sudo: vagrant : TTY=pts/0 ; PWD=/home/vagrant ; USER=root ; COMMAND=/bin/ls /root/</span><br><span class="line">Feb 22 13:45:45 localhost sudo: vagrant : TTY=pts/0 ; PWD=/home/vagrant ; USER=root ; COMMAND=/bin/cat /var/log/secure</span><br><span class="line">Feb 22 13:46:10 localhost sudo: vagrant : TTY=pts/0 ; PWD=/home/vagrant ; USER=root ; COMMAND=/bin/tail /var/log/secure</span><br></pre></td></tr></table></figure>

<h3 id="補充"><a href="#補充" class="headerlink" title="補充"></a>補充</h3><p><code>NIS</code>：集中驗證</p>
<p><code>IPA</code>：集中授權管理</p>
<p><code>sudo su -</code> or <code>sudo -s</code>：用一般的 user 切換成 root，輸入一般 user 的密碼</p>
<h2 id="5-3-Managing-Local-User-Accounts"><a href="#5-3-Managing-Local-User-Accounts" class="headerlink" title="5.3 Managing Local User Accounts"></a>5.3 Managing Local User Accounts</h2><h3 id="Managing-local-users"><a href="#Managing-local-users" class="headerlink" title="Managing local users"></a>Managing local users</h3><p><code>/etc/login.defs</code> 檔案中紀錄了新增使用者時的相關預設設定，例如 UID range, 密碼有效期限 … 等</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@server ~]$ <span class="built_in">cat</span> /etc/login.defs | grep <span class="string">&#x27;^[^#]&#x27;</span></span><br><span class="line">MAIL_DIR        /var/spool/mail</span><br><span class="line">PASS_MAX_DAYS   99999</span><br><span class="line">PASS_MIN_DAYS   0</span><br><span class="line">PASS_MIN_LEN    5</span><br><span class="line">PASS_WARN_AGE   7</span><br><span class="line">UID_MIN                  1000</span><br><span class="line">UID_MAX                 60000</span><br><span class="line">SYS_UID_MIN               201</span><br><span class="line">SYS_UID_MAX               999</span><br><span class="line">GID_MIN                  1000</span><br><span class="line">GID_MAX                 60000</span><br><span class="line">SYS_GID_MIN               201</span><br><span class="line">SYS_GID_MAX               999</span><br><span class="line">CREATE_HOME     <span class="built_in">yes</span></span><br><span class="line">UMASK           077</span><br><span class="line">USERGROUPS_ENAB <span class="built_in">yes</span></span><br><span class="line">ENCRYPT_METHOD SHA512</span><br></pre></td></tr></table></figure>

<h4 id="usermode-modifies-existing-users"><a href="#usermode-modifies-existing-users" class="headerlink" title="usermode modifies existing users"></a>usermode modifies existing users</h4><p><code>usermod</code> 用來修改使用者資訊，相關參數如下：</p>
<table>
<thead>
<tr>
<th>參數</th>
<th>說明</th>
</tr>
</thead>
<tbody><tr>
<td><code>-g/--gid</code> GROUP</td>
<td>設定 user 的 primary group</td>
</tr>
<tr>
<td><code>-G/--groups</code> GROUPS</td>
<td>設定 user 的 supplementary group</td>
</tr>
<tr>
<td><code>-a/--append</code></td>
<td>與 <code>-G</code> 搭配，用來增加 supplementary group 設定</td>
</tr>
<tr>
<td><code>-d/--home</code> HOME_DIR</td>
<td>設定 user 家目錄</td>
</tr>
<tr>
<td><code>-m/--move-home</code></td>
<td>移動 user 家目錄到新的地方，必須與 <code>-d</code> 參數同時使用</td>
</tr>
<tr>
<td><code>-s/--shell</code> SHELL</td>
<td>指定登入 shell</td>
</tr>
<tr>
<td><code>-L/--lock</code></td>
<td>鎖定 user</td>
</tr>
<tr>
<td><code>-U/--unlock</code></td>
<td>解鎖 user</td>
</tr>
</tbody></table>
<h4 id="userdel-deletes-users"><a href="#userdel-deletes-users" class="headerlink" title="userdel deletes users"></a>userdel deletes users</h4><p><code>userdel -r username</code>：會將 user 刪除，連同家目錄 &amp; mail 都一併移除</p>
<blockquote>
<p>userdel 命令若沒有加上 -r 參數，可能會有安全疑慮，主要是沒有 owner &amp; owner group 的檔案可能會被新增的 user 取得存取權限</p>
</blockquote>
<blockquote>
<p>此問題可透過 <code>sudo find / -nouser -o --nogroup 2&gt;/dev/null</code> 指令來找到if沒有 owner &amp; owner group 的檔案</p>
</blockquote>
<h4 id="id-displays-user-information"><a href="#id-displays-user-information" class="headerlink" title="id displays user information"></a>id displays user information</h4><p><code>id</code> 可用來顯示使用者資訊</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@server ~]$ <span class="built_in">id</span></span><br><span class="line">uid=1000(vagrant) gid=1000(vagrant) <span class="built_in">groups</span>=1000(vagrant),10(wheel) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br><span class="line"></span><br><span class="line">[vagrant@server ~]$ <span class="built_in">id</span> root</span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br></pre></td></tr></table></figure>

<h4 id="UID-ranges"><a href="#UID-ranges" class="headerlink" title="UID ranges"></a>UID ranges</h4><p>UID 在 RHEL 7 中的定義：(預設值可參考 <code>/etc/login.defs</code>)</p>
<ul>
<li><p><code>UID 0</code>：root</p>
</li>
<li><p><code>UID 1-200</code>：system users，通常用來啟動系統服務之用</p>
</li>
<li><p><code>UID 201-999</code>：保留的 system users，有其他額外未預先定義的系統服務需要時可使用</p>
</li>
<li><p><code>UID 1000</code>：一般使用者用的 UID</p>
</li>
</ul>
<blockquote>
<p>在 RHEL 7 之前，system user 使用 UID 1-499，一般使用者使用  UID 500+</p>
</blockquote>
<h3 id="Practice"><a href="#Practice" class="headerlink" title="Practice"></a>Practice</h3><p>使用 variable 新增 user：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@server ~]$ USER=juliet</span><br><span class="line"></span><br><span class="line">[vagrant@server ~]$ <span class="built_in">echo</span> <span class="variable">$USER</span></span><br><span class="line">juliet</span><br><span class="line"></span><br><span class="line">[vagrant@server ~]$ sudo useradd <span class="variable">$&#123;USER&#125;</span>; <span class="built_in">echo</span> <span class="variable">$&#123;USER&#125;</span> | sudo passwd --stdin <span class="variable">$&#123;USER&#125;</span></span><br><span class="line">Changing password <span class="keyword">for</span> user juliet.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>


<h2 id="5-4-Managing-Local-Group-Accounts"><a href="#5-4-Managing-Local-Group-Accounts" class="headerlink" title="5.4 Managing Local Group Accounts"></a>5.4 Managing Local Group Accounts</h2><h3 id="5-4-1-Managing-supplementary-groups"><a href="#5-4-1-Managing-supplementary-groups" class="headerlink" title="5.4.1 Managing supplementary groups"></a>5.4.1 Managing supplementary groups</h3><h4 id="groupadd"><a href="#groupadd" class="headerlink" title="groupadd"></a>groupadd</h4><ul>
<li><code>-r</code>：用來增加 system group (GID &gt; 1000)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 -g 選項指定 GID</span></span><br><span class="line">$ sudo groupadd -g 5000 ateam</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 -r 選項姜群組新增成 system group</span></span><br><span class="line">$ sudo groupadd -r appusers</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查詢系統中預設 GID range</span></span><br><span class="line">[vagrant@server ~]$ <span class="built_in">cat</span> /etc/login.defs | grep GID</span><br><span class="line">GID_MIN                  1000</span><br><span class="line">GID_MAX                 60000</span><br><span class="line">SYS_GID_MIN               201</span><br><span class="line">SYS_GID_MAX               999</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>/etc/login.defs</code> 檔案中紀錄了許多與使用者 &amp; 群組管理上相關的預設參數</p>
</blockquote>
<h4 id="groupmod"><a href="#groupmod" class="headerlink" title="groupmod"></a>groupmod</h4><ul>
<li><p><code>-n</code>：修改群組名稱</p>
</li>
<li><p><code>-g</code>：修改 GID (這會衍生非預期的問題)</p>
<ul>
<li>家目錄不會改</li>
<li>相對應的檔案 &amp; 目錄皆不會改</li>
</ul>
</li>
</ul>
<h4 id="usermod-alters-group-membership"><a href="#usermod-alters-group-membership" class="headerlink" title="usermod alters group membership"></a>usermod alters group membership</h4><ul>
<li><p><code>-g</code>：指定 primary group</p>
</li>
<li><p><code>sudo usermod -g NEW_PRIMARY_GROUPNAME USERNAME</code>：變更指定使用者的 primary group</p>
</li>
<li><p><code>-G</code>：指定 supplementary group</p>
</li>
<li><p><code>sudo uermod -aG SUPPLYMENTARY_GROUP USERNAME</code>：新增使用者的 supplementary group</p>
</li>
</ul>
<h2 id="5-5-Managing-User-Passwords"><a href="#5-5-Managing-User-Passwords" class="headerlink" title="5.5 Managing User Passwords"></a>5.5 Managing User Passwords</h2><h3 id="5-5-1-Shadow-passwords-and-password-policy"><a href="#5-5-1-Shadow-passwords-and-password-policy" class="headerlink" title="5.5.1 Shadow passwords and password policy"></a>5.5.1 Shadow passwords and password policy</h3><p>現在為了安全性，密碼都已經改存到只有 root 能讀取的 <code>/etc/shadow</code> 中，分為幾個欄位：</p>
<ol>
<li><code>name</code>：使用者名稱</li>
<li><code>password</code>：密碼</li>
<li><code>lastchange</code>：上次修改時間 (為單一數值，從 1970/01/01 作為第1天起算) (改為 0，強制使用者必須在下次登入時改密碼)</li>
<li><code>minage</code>：密碼存活的最小生命周期(0 表示馬上可以改回來)</li>
<li><code>maxage</code>：密碼存活的最大生命周期(最大為 99999，從 <code>lastchange</code> 開始算)</li>
<li><code>warning</code>：提醒使用者的時間 (default: 7，七天前提醒)</li>
<li><code>inactive</code>：寬限期，最多密碼可以存活 (maxage + inactive) 天；在寬限期登入會被強制要求更改密碼</li>
<li><code>expire</code>：密碼失效日期，不受前面欄位影響，過期就表示密碼完全失效</li>
<li><code>blank</code>：保留作為未來使用</li>
</ol>
<p>說明第 2 個欄位 <code>password</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@desktop ~]$ sudo <span class="built_in">tail</span> -3 /etc/shadow</span><br><span class="line">juliet:$6$TFn6B61u<span class="variable">$sA</span>/maknNkUeghjzgrGkoAiLYzNa/KqDQDR5A0m0PxTZeac4gdXQAleR.sxWcWK5VZnnSIhSAsD/WnIZr51MZA/:16864:0:99999:7:::</span><br><span class="line">romeo:$6$vRE6wD1I<span class="variable">$4eh6QNLPzyMw9pVjr</span>.YwOia6s8y1zixFq2LpHSi/n.Q/A45J/jqiBCNXRJan2rl0p6MwuL.91mf3IkRNZQUVv.:16864:0:99999:7:::</span><br><span class="line">hamlet:$6<span class="variable">$Nu8r</span>/BWW<span class="variable">$PqoSIv9iRx9oQEH2ziw4L2WH0HMXs2YXFvEH8SFHmmKd</span>/WxeAV0qOweqAXUN6TE375W7ShHHLxP6i7jBcHsD/1:16864:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>以 user juliet <code>$6$TFn6B61u$sA/maknNkUeghjz</code> 為例：(以 <strong><font color='red'>$</font></strong> 作為分隔)</p>
<ol>
<li><p><code>6</code>：第一個部分，表示加密用的 hash 演算法，1 = MD5，6 = SHA-512 (RHEL 7 預設為 6)</p>
</li>
<li><p><code>TFn6B61u</code>：用來在加密密碼時用的 random 字串(salt)，加密時會一起用到，為了避免同樣密碼的使用者會有相同的 hash 結果</p>
</li>
<li><p><code>sA/maknNkUeghjz....</code>：hash(password + salt) 的結果</p>
</li>
</ol>
<blockquote>
<p><code>/etc/shadow</code> 的詳細說明，可以參考 <a target="_blank" rel="noopener" href="http://linux.vbird.org/linux_basic/0410accountmanager.php#shadow_file">鳥哥的 Linux 私房菜 – 第十三章、Linux 帳號管理與 ACL 權限設定</a></p>
</blockquote>
<ol>
<li><p><code>name</code>：使用者帳號</p>
</li>
<li><p><code>password</code>：上述的密碼資訊</p>
</li>
<li><p><code>lastchange</code>：從 1970/01/01 起算的日期(0 表示強制使用者下次登入時變更密碼)</p>
</li>
<li><p><code>min days</code>：</p>
</li>
<li><p><code>max days</code></p>
</li>
<li><p><code>warning</code></p>
</li>
<li><p><code>inactive</code></p>
</li>
<li><p><code>expires</code></p>
</li>
<li><p><code>blank</code></p>
</li>
</ol>
<h3 id="5-5-2-Password-aging"><a href="#5-5-2-Password-aging" class="headerlink" title="5.5.2 Password aging"></a>5.5.2 Password aging</h3><p><img src="https://lh3.googleusercontent.com/2bDqeWVGlV0vGtV0lm6TE-1KwHmNixd6pUAaDGh30pcFJGF3tI3WUsV6dxUzdRbSPh7dR3mzznf_EdinGaKeWQA1xrA9cdOJFajn-jQFCcgEfni4Sdpn4zd-6R4T-Rj0Cezry17a0m_hI61F1nD8TjQFomv6NltRNseZgPgHVM1JU0or0xr8Y322N7MfhzoQIXeLQgQMLTsKtLAr19avk7A3yUQiZn5m6RI6T0rVqmW2FsXYwGEiQiDQlmg9POKDIndNH9LknDoIGHK5PAL_03cmbuY5EdouDrBMQu1PCESLO5GvZgzG-UIWNXMYk692Rai3Cpw6zNbyMUdwqpzvUaCgsPFHYcRfA9C3U1VJ4p-O2Q9iIKq5-8DWzEzGb7HELfYNwAHny8QGnXBGnHa7qtzVUJseFngyW3I2T-rCD7rriDbNYep4-V_fSqMSCNFSpVcs6Xnaj9TmnmXoegWDt3p43VTQxqPPb5C1LpyOK8mwwzFJdrYEjRJNmRzz6o4tUTqfbeay_UdKTzARA4MrsP6k2X5wHPWlDOao9eh7cMtRsyQpk9KE3Mp2l44mIHs_tuIE=w657-h235-no" alt="Linux Password Aging"></p>
<p>RHEL7 用來加密密碼的 hash algorithm 已經預設改為 <code>SHA-512</code>(<font color='red'><strong>6</strong></font>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 強制使用者下次登入修改密碼</span></span><br><span class="line">$ chage -d 0 USER_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以 human readable 的方式顯示 /etc/shadow 的內容</span></span><br><span class="line">$ chage -l USER_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定密碼失效日期 (也可以改用數字)</span></span><br><span class="line">$ chage -E YYYY-MM-DD USER_NAME</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 檢視 juliet 目前的密碼期限相關設定</span></span><br><span class="line">[vagrant@desktop ~]$ sudo chage -l juliet</span><br><span class="line">Last password change                                    : Mar 04, 2016</span><br><span class="line">Password expires                                        : never</span><br><span class="line">Password inactive                                       : never</span><br><span class="line">Account expires                                         : never</span><br><span class="line">Minimum number of days between password change          : 0</span><br><span class="line">Maximum number of days between password change          : 99999</span><br><span class="line">Number of days of warning before password expires       : 7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 強制 juliet 在下次登入時變更密碼</span></span><br><span class="line">[vagrant@desktop ~]$ sudo chage -d 0 juliet</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 -E YYYY-MM-dd 的設定方式將帳號過期時間設定為 45 天後</span></span><br><span class="line">[vagrant@desktop ~]$ sudo chage -E $(<span class="built_in">date</span> -d <span class="string">&quot;+45 days&quot;</span> +%F) juliet</span><br></pre></td></tr></table></figure>

<h3 id="5-5-3-Restricting-access"><a href="#5-5-3-Restricting-access" class="headerlink" title="5.5.3 Restricting access"></a>5.5.3 Restricting access</h3><p>限制使用者存取的方式：</p>
<ol>
<li>Lock USER_NAME</li>
<li>給 Expiration Date</li>
<li>把 shell 給成 /sbin/nologin</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下兩個功能相同</span></span><br><span class="line">$ sudo usermod -L USER_NAME</span><br><span class="line">$ sudo passwd -l USER_NAME</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lock user</span></span><br><span class="line">$ sudo usermod -L juliet</span><br><span class="line"></span><br><span class="line"><span class="comment"># unlock user</span></span><br><span class="line">$ sudo usermod -U juliet</span><br><span class="line"></span><br><span class="line"><span class="comment"># 設定 nologin shell 給使用者，使用者就沒有 shell 可用(例如：mail service)</span></span><br><span class="line">$ sudo usermod -s /sbin/nologin juliet</span><br></pre></td></tr></table></figure>

<h3 id="5-5-4-Lab-Managing-Local-Linux-Users-and-Groups"><a href="#5-5-4-Lab-Managing-Local-Linux-Users-and-Groups" class="headerlink" title="5.5.4 Lab: Managing Local Linux Users and Groups"></a>5.5.4 Lab: Managing Local Linux Users and Groups</h3><p>修改 <code>/etc/login.defs</code>(<font color='red'><strong>PASS_MAX_DAYS</strong></font>) 將密碼預設過期日改為 30</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新增一個 GID 40000，名稱為 consultants 的群組</span></span><br><span class="line">$ groupadd -g 40000 consultants</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新增使用者，指定 GID 為 40000，並設定密碼為 default</span></span><br><span class="line">$ USR=sspade; useradd -G 40000 <span class="variable">$&#123;USR&#125;</span>; <span class="built_in">echo</span> <span class="string">&quot;default&quot;</span> | passwd --stdin <span class="variable">$&#123;USR&#125;</span></span><br><span class="line">$ USR=bboop; useradd -G 40000 <span class="variable">$&#123;USR&#125;</span>; <span class="built_in">echo</span> <span class="string">&quot;default&quot;</span> | passwd --stdin <span class="variable">$&#123;USR&#125;</span></span><br><span class="line">$ USR=dtracy; useradd -G 40000 <span class="variable">$&#123;USR&#125;</span>; <span class="built_in">echo</span> <span class="string">&quot;default&quot;</span> | passwd --stdin <span class="variable">$&#123;USR&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 設定 sspade, bboop, dreacy 的密碼過期日(expiration date)為 90 天後</span></span><br><span class="line">$ chage -E $(<span class="built_in">date</span> -d <span class="string">&quot;+90 days&quot;</span> +%Y-%m-%d) sspade</span><br><span class="line">$ chage -E $(<span class="built_in">date</span> -d <span class="string">&quot;+90 days&quot;</span> +%Y-%m-%d) bboop</span><br><span class="line">$ chage -E $(<span class="built_in">date</span> -d <span class="string">&quot;+90 days&quot;</span> +%Y-%m-%d) dtracy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制 bboop 每 15 天要改一次密碼</span></span><br><span class="line">$ chage -M 15 bboop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 強制 sspade, bboop, dreacy 下次登入時要改密碼</span></span><br><span class="line">$ chage -d 0 sspade</span><br><span class="line">$ chage -d 0 bboop</span><br><span class="line">$ chage -d 0 dtracy</span><br></pre></td></tr></table></figure>

<h2 id="5-6-Practice-Managing-User-Password-Aging"><a href="#5-6-Practice-Managing-User-Password-Aging" class="headerlink" title="5.6 Practice: Managing User Password Aging"></a>5.6 Practice: Managing User Password Aging</h2><p>Lock User：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lock 使用者 romeo</span></span><br><span class="line">[vagrant@desktop ~]$ sudo usermod -L romeo</span><br><span class="line"><span class="comment"># 無法切換使用者，因為已經 lock</span></span><br><span class="line">[vagrant@desktop ~]$ su - romeo</span><br><span class="line">Password:</span><br><span class="line">su: Authentication failure</span><br><span class="line"></span><br><span class="line"><span class="comment"># unlock 之後便可登入</span></span><br><span class="line">[vagrant@desktop ~]$ sudo usermod -U romeo</span><br><span class="line">[vagrant@desktop ~]$ su - romeo</span><br><span class="line">Password:</span><br><span class="line">Last login: Wed Mar  9 14:39:24 UTC 2016 on pts/0</span><br><span class="line">Last failed login: Wed Mar  9 14:40:51 UTC 2016 on pts/0</span><br><span class="line">There were 2 failed login attempts since the last successful login.</span><br><span class="line">[romeo@desktop ~]$</span><br></pre></td></tr></table></figure>

<p>設定密碼過期時間 90 天 &amp; 下次登入時修改密碼：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@desktop ~]$ sudo chage -l romeo</span><br><span class="line">Last password change                                    : Mar 09, 2016</span><br><span class="line">Password expires                                        : never</span><br><span class="line">Password inactive                                       : never</span><br><span class="line">Account expires                                         : never</span><br><span class="line">Minimum number of days between password change          : 0</span><br><span class="line">Maximum number of days between password change          : 99999</span><br><span class="line">Number of days of warning before password expires       : 7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 設定密碼過期時間 90 天</span></span><br><span class="line">[vagrant@desktop ~]$ sudo chage -M 90 romeo</span><br><span class="line">[vagrant@desktop ~]$ sudo chage -l romeo</span><br><span class="line">Last password change                                    : Mar 09, 2016</span><br><span class="line">Password expires                                        : Jun 07, 2016</span><br><span class="line">Password inactive                                       : never</span><br><span class="line">Account expires                                         : never</span><br><span class="line">Minimum number of days between password change          : 0</span><br><span class="line">Maximum number of days between password change          : 90</span><br><span class="line">Number of days of warning before password expires       : 7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 強制使用者下次登入時變更密碼</span></span><br><span class="line">[vagrant@desktop ~]$ sudo chage -l romeo</span><br><span class="line">Last password change                                    : password must be changed</span><br><span class="line">Password expires                                        : password must be changed</span><br><span class="line">Password inactive                                       : password must be changed</span><br><span class="line">Account expires                                         : never</span><br><span class="line">Minimum number of days between password change          : 0</span><br><span class="line">Maximum number of days between password change          : 90</span><br><span class="line">Number of days of warning before password expires       : 7</span><br></pre></td></tr></table></figure>

<p>設定使用者密碼過期時間為 180 天後：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@desktop ~]$ sudo chage -E $(<span class="built_in">date</span> -d <span class="string">&quot;+180 days&quot;</span> +%F) romeo</span><br><span class="line">[vagrant@desktop ~]$ sudo chage -l romeo</span><br><span class="line">Last password change                                    : Mar 09, 2016</span><br><span class="line">Password expires                                        : Jun 07, 2016</span><br><span class="line">Password inactive                                       : never</span><br><span class="line">Account expires                                         : Sep 05, 2016</span><br><span class="line">Minimum number of days between password change          : 0</span><br><span class="line">Maximum number of days between password change          : 90</span><br><span class="line">Number of days of warning before password expires       : 7</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Chapter-6-Controlling-Access-to-Files-with-Linux-File-System-Permissions"><a href="#Chapter-6-Controlling-Access-to-Files-with-Linux-File-System-Permissions" class="headerlink" title="Chapter 6. Controlling Access to Files with Linux File System Permissions"></a>Chapter 6. Controlling Access to Files with Linux File System Permissions</h1><h2 id="6-1-Linux-File-System-Permissions"><a href="#6-1-Linux-File-System-Permissions" class="headerlink" title="6.1 Linux File System Permissions"></a>6.1 Linux File System Permissions</h2><h3 id="6-1-1-Linux-file-system-permissions"><a href="#6-1-1-Linux-file-system-permissions" class="headerlink" title="6.1.1 Linux file system permissions"></a>6.1.1 Linux file system permissions</h3><blockquote>
<p>新增/刪除檔案不是看檔案本身權限，而是看上層目錄的權限</p>
</blockquote>
<p>當使用者擁有目錄的 <code>w(write)</code> &amp; <code>x(execute)</code> 權限時，可以刪除該目錄中自己也沒有權限的檔案，但這問題可以透過 <code>sticky bit</code> 來解決!</p>
<p>正常對目錄有存取權限的使用者，會同時有 <code>r(read)</code> &amp; <code>w(write)</code> 兩個權限：</p>
<ul>
<li><p>若沒有目錄的 <code>r(read)</code> 權限，使用者無法列出目錄中的檔案，但若知道明確檔名還是可以存取</p>
</li>
<li><p>若沒有目錄的 <code>w(write)</code> 權限，就只能列出目錄中的檔案內容，但都無法存取目錄中的任何檔案(連 timestamp 資訊都看不到)</p>
</li>
<li><p>但如果進不了目錄(<strong><font color='red'>沒有 execute 權限</font></strong>)，還是無法刪除檔案</p>
</li>
</ul>
<h3 id="6-1-2-Viewing-file-directory-permissions-and-ownership"><a href="#6-1-2-Viewing-file-directory-permissions-and-ownership" class="headerlink" title="6.1.2 Viewing file/directory permissions and ownership"></a>6.1.2 Viewing file/directory permissions and ownership</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出目錄中所有子目錄 &amp; 檔案的相關權限資訊</span></span><br><span class="line">[vagrant@server ~]$ <span class="built_in">ls</span> -l /home</span><br><span class="line">total 4</span><br><span class="line">drwx------. 6 vagrant vagrant 4096 Mar 30 20:23 vagrant</span><br><span class="line"></span><br><span class="line"><span class="comment"># 透過 &#x27;-d&#x27; 參數，僅列出指定目錄的權限 (權限中的最後一個 . 是作為 ACL 控制用)</span></span><br><span class="line">[vagrant@server ~]$ <span class="built_in">ls</span> -ld /home</span><br><span class="line">drwxr-xr-x. 3 root root 20 Jan  3 04:22 /home</span><br></pre></td></tr></table></figure>

<h2 id="6-2-Managing-File-System-Permissions-from-the-Command-Line"><a href="#6-2-Managing-File-System-Permissions-from-the-Command-Line" class="headerlink" title="6.2 Managing File System Permissions from the Command Line"></a>6.2 Managing File System Permissions from the Command Line</h2><h3 id="6-2-1-Changing-file-directory-permissions"><a href="#6-2-1-Changing-file-directory-permissions" class="headerlink" title="6.2.1 Changing file/directory permissions"></a>6.2.1 Changing file/directory permissions</h3><p>透過 chmod -R 以遞迴的方式指定檔案 &amp; 目錄的權限時，若包含了 x(execute) 權限，會讓檔案 &amp; 目錄同時都有 x(execute) 的權限，但這通常不是我們需要的結果；一般我們只會希望只有目錄才需要 x(execute) 權限，此時只要加上大寫 <code>W</code> 參數即可：</p>
<p>例如：<code>chmod -R g+rwX somedir</code> 表示 somedir 目錄下所有的檔案都給 rw 權限，目錄則是給 rwx 權限。</p>
<h3 id="6-2-2-Changing-file-directory-user-or-group-ownership"><a href="#6-2-2-Changing-file-directory-user-or-group-ownership" class="headerlink" title="6.2.2 Changing file/directory user or group ownership"></a>6.2.2 Changing file/directory user or group ownership</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下兩個指令功能相同，都是修改檔案的 group ownership</span></span><br><span class="line">[vagrant@server ch06]$ sudo <span class="built_in">chown</span> :vboxsf 1st/aa</span><br><span class="line">[vagrant@server ch06]$ sudo <span class="built_in">chgrp</span> vboxsf 1st/aa</span><br></pre></td></tr></table></figure>
<blockquote>
<p>只有 root 可以修改檔案的 ownership，一般使用者儘可以針對自己所屬的群組設定 ownership</p>
</blockquote>
<p>一般 web 網站的目錄，只會開啟目錄的 execute 權限，並且讓目錄內的檔案有 others read 的權限，讓使用者可以進入目錄，可以存取目錄中檔案的內容，但卻無法列出目錄中所有的檔案</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 檔案 file1 拿掉 group &amp; others 的 read &amp; write 權限</span></span><br><span class="line">$ <span class="built_in">chmod</span> go-rw file1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 針對多層目錄 &amp; 檔案透過遞迴的方式設定權限(group 給予所有權限)</span></span><br><span class="line">$ <span class="built_in">chmod</span> -R g+rwx multi_layer_dir</span><br><span class="line"></span><br><span class="line"><span class="comment"># 針對多層目錄(只有目錄，沒有檔案)，使用遞迴的方式指定所有人有 execute 的權限</span></span><br><span class="line"><span class="comment"># 透過大寫 X，指定套用權限時僅會套用在目錄上，不會在檔案上</span></span><br><span class="line">$ <span class="built_in">chmod</span> -R a+X multi_layer_dir</span><br></pre></td></tr></table></figure>

<p>只有 root 可以變更檔案的 ownership</p>
<blockquote>
<p>例外：檔案擁有者可以改檔案所屬群組，但只可以改成屬於自己群組</p>
</blockquote>
<h2 id="6-3-Managing-Default-Permissions-and-File-Access"><a href="#6-3-Managing-Default-Permissions-and-File-Access" class="headerlink" title="6.3 Managing Default Permissions and File Access"></a>6.3 Managing Default Permissions and File Access</h2><h3 id="6-3-1-Special-permissions"><a href="#6-3-1-Special-permissions" class="headerlink" title="6.3.1 Special permissions"></a>6.3.1 Special permissions</h3><p>若檔案的 execute 權限標示為 <code>setuid</code> or <code>setgid</code> 時(以 <code>s</code> 表示權限)，表示此檔案不論是哪個使用者執行，會以檔案 owner 的身分(<code>setgid</code> 會以群組的身分)執行，而不是執行檔案的使用者。 例如：**/etc/passwd**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@server ~]$ <span class="built_in">ls</span> -al /usr/bin/passwd</span><br><span class="line">-rwsr-xr-x. 1 root root 27832 Jun 10  2014 /usr/bin/passwd</span><br></pre></td></tr></table></figure>

<p>若 sticky bit(以 <code>t</code> 表示權限) 位於 directory 時，以 <strong><font color='red'>/tmp</font></strong> 為例，<strong>只有檔案的擁有者才可以刪除檔案</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@server ~]$ <span class="built_in">ls</span> -ld /tmp/</span><br><span class="line">drwxrwxrwt. 7 root root 88 Apr  3 01:00 /tmp/</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>設定方式</th>
<th>在檔案上的效果</th>
<th>在目錄上的效果</th>
</tr>
</thead>
<tbody><tr>
<td><code>u+s</code>(4)</td>
<td>檔案執行時會以 owner user 的權限執行</td>
<td>N/A</td>
</tr>
<tr>
<td><code>g+s</code>(2)</td>
<td>檔案執行時會以 owner group 的權限執行</td>
<td>在此目錄中新建立的檔案會擁有與目錄相同的 group 權限</td>
</tr>
<tr>
<td><code>o+t</code>(1)</td>
<td>N/A</td>
<td>在此目錄中，使用者僅能移除他們自己所建立的檔案</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setuid</span></span><br><span class="line">$ <span class="built_in">chmod</span> u+s some_file</span><br><span class="line"></span><br><span class="line"><span class="comment"># setgid</span></span><br><span class="line">$ <span class="built_in">chmod</span> g+s,o-rx some_dir</span><br><span class="line">$ <span class="built_in">chmod</span> 2770 some_dir</span><br></pre></td></tr></table></figure>

<h4 id="SetUID"><a href="#SetUID" class="headerlink" title="SetUID"></a>SetUID</h4><ul>
<li>檔案<blockquote>
<p>-rwsr-xr-x 1 root root 47032 Jul 16  2015 /usr/bin/passwd -&gt; /etc/shadow<br>passwd 指令的 owner 為 root，因此執行此指令時是以 root 的權限執行</p>
</blockquote>
</li>
</ul>
<h4 id="SetGID"><a href="#SetGID" class="headerlink" title="SetGID"></a>SetGID</h4><ul>
<li><p>檔案</p>
<blockquote>
<p>/usr/bin/locate -&gt; /var/lib/mlocate/mlocate.db</p>
</blockquote>
</li>
<li><p>目錄</p>
<blockquote>
<p>SetGID 設定在目錄上，則表示在該目錄中建立的檔案 or 目錄的擁有群組都會被強制設定為該目錄的擁有群組</p>
</blockquote>
</li>
</ul>
<h4 id="Sticky-Bit"><a href="#Sticky-Bit" class="headerlink" title="Sticky Bit"></a>Sticky Bit</h4><ul>
<li>目錄<blockquote>
<p><code>o+t</code> 表示該目錄中的檔案只有擁有者可以移除</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>**<font color='red'>T</font>**：表示 others 原本沒有 execute 權限</p>
</blockquote>
<blockquote>
<p>**<font color='red'>t</font>**：表示 others 原本有 execute 權限</p>
</blockquote>
<h3 id="6-3-2-Default-file-permissions"><a href="#6-3-2-Default-file-permissions" class="headerlink" title="6.3.2 Default file permissions"></a>6.3.2 Default file permissions</h3><p>Default permission (system)</p>
<ul>
<li>File: <code>666</code></li>
<li>Directory: <code>777</code></li>
</ul>
<p>Default Umask:</p>
<ul>
<li>root：<code>022</code></li>
<li>regular user：<code>002</code></li>
</ul>
<p>umask 使用 3 個數字進行修改，若少於 3 個數字，前面會被自動補 0；且更改的效果僅限於該 terminal session 中，重新登入後就會無效。</p>
<p>umask 的設定，若是要設定 global 的，可以到 <strong><font color='red'>/etc/profile</font></strong> &amp; <strong><font color='red'>/etc/bashrc</font></strong> 中進行調整</p>
<p>如果要進行個人化設定，則可以到 <strong><font color='red'>~/.bash_profile</font></strong> &amp; <strong><font color='red'>~/.bashrc</font></strong> 中進行調整</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/Linux/" rel="tag"># Linux</a>
              <a href="/blog/tags/RHCE/" rel="tag"># RHCE</a>
              <a href="/blog/tags/RH124/" rel="tag"># RH124</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/RHCE/RHCE7-RH124-LearningNotes-CH01_03/" rel="prev" title="[RHCE] RH124 Chapter 1~3 學習筆記">
                  <i class="fa fa-chevron-left"></i> [RHCE] RH124 Chapter 1~3 學習筆記
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/RHCE/RHCE7-RH124-LearningNotes-CH07_MonitoringAndManagingLinuxProcesses/" rel="next" title="[RHCE] RH124 Chapter 7 Monitoring and Managing Linux Processes 學習筆記">
                  [RHCE] RH124 Chapter 7 Monitoring and Managing Linux Processes 學習筆記 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  



      
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">godleon</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
<script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/schemes/muse.js"></script><script src="/blog/js/next-boot.js"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  















  








    <div class="pjax">
  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://godleon-blog-hexo.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://godleon.github.io/blog/RHCE/RHCE7-RH124-LearningNotes-CH04_06/";
    this.page.identifier = "RHCE/RHCE7-RH124-LearningNotes-CH04_06/";
    this.page.title = "[RHCE] RH124 Chapter 4~6 學習筆記";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://godleon-blog-hexo.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

    </div>
</body>
</html>
