<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"godleon.github.io","root":"/blog/","scheme":"Muse","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false};
  </script>

  <meta name="description" content="此篇文章介紹使用 Helm v3 管理 Kubernetes workloads">
<meta property="og:type" content="article">
<meta property="og:title" content="[Helm] Helm v3 使用簡介">
<meta property="og:url" content="https://godleon.github.io/blog/DevOps/Helm-v3-Chart-Template-Guide/index.html">
<meta property="og:site_name" content="小信豬的原始部落">
<meta property="og:description" content="此篇文章介紹使用 Helm v3 管理 Kubernetes workloads">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://godleon.github.io/blog/images/devops/helm_first-chart.png">
<meta property="article:published_time" content="2020-09-14T03:00:00.000Z">
<meta property="article:modified_time" content="2023-07-14T08:10:30.470Z">
<meta property="article:author" content="godleon">
<meta property="article:tag" content="DevOps">
<meta property="article:tag" content="Helm">
<meta property="article:tag" content="Kubernetes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://godleon.github.io/blog/images/devops/helm_first-chart.png">


<link rel="canonical" href="https://godleon.github.io/blog/DevOps/Helm-v3-Chart-Template-Guide/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>[Helm] Helm v3 使用簡介 | 小信豬的原始部落</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-703592-7"></script>
    <script data-pjax>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-703592-7');
      }
    </script>






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">小信豬的原始部落</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%9D-Helm"><span class="nav-number">1.</span> <span class="nav-text">安裝 Helm</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Getting-Started"><span class="nav-number">2.</span> <span class="nav-text">Getting Started</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Chart-%E5%9F%BA%E6%9C%AC%E7%B5%90%E6%A7%8B"><span class="nav-number">2.1.</span> <span class="nav-text">Chart 基本結構</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E7%94%A2%E7%94%9F-chart-template"><span class="nav-number">2.2.</span> <span class="nav-text">快速產生 chart template</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E6%96%B0%E7%9A%84-namespace-%E9%80%B2%E8%A1%8C%E9%96%8B%E7%99%BC%E6%B8%AC%E8%A9%A6"><span class="nav-number">2.3.</span> <span class="nav-text">建立新的 namespace 進行開發測試</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E5%80%8B-template"><span class="nav-number">2.4.</span> <span class="nav-text">建立第一個 template</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Built-in-Objects"><span class="nav-number">3.</span> <span class="nav-text">Built-in Objects</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Release"><span class="nav-number">3.1.</span> <span class="nav-text">Release</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Values"><span class="nav-number">3.2.</span> <span class="nav-text">Values</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chart"><span class="nav-number">3.3.</span> <span class="nav-text">Chart</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Files"><span class="nav-number">3.4.</span> <span class="nav-text">Files</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Capabilities"><span class="nav-number">3.5.</span> <span class="nav-text">Capabilities</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Template"><span class="nav-number">3.6.</span> <span class="nav-text">Template</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Values-%E6%AA%94%E6%A1%88%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-number">4.</span> <span class="nav-text">Values 檔案的使用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%99%E6%BA%96%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-number">4.1.</span> <span class="nav-text">標準使用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8B%A5%E8%A6%81%E5%88%AA%E9%99%A4-default-key"><span class="nav-number">4.2.</span> <span class="nav-text">若要刪除 default key</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Template-Functions-and-Pipelines"><span class="nav-number">5.</span> <span class="nav-text">Template Functions and Pipelines</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Pipelines"><span class="nav-number">5.1.</span> <span class="nav-text">Pipelines</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Flow-Control"><span class="nav-number">6.</span> <span class="nav-text">Flow Control</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#if-else"><span class="nav-number">6.1.</span> <span class="nav-text">if&#x2F;else</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%99%95%E7%90%86%E7%A9%BA%E7%99%BD%E5%AD%97%E5%85%83"><span class="nav-number">6.2.</span> <span class="nav-text">處理空白字元</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%8F%E9%81%8E-%E2%80%9Cwith%E2%80%9D-%E9%97%9C%E9%8D%B5%E5%AD%97%E4%BE%86%E9%99%90%E5%AE%9A%E8%AE%8A%E6%95%B8%E7%AF%84%E5%9C%8D"><span class="nav-number">6.3.</span> <span class="nav-text">透過 “with” 關鍵字來限定變數範圍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-%E2%80%9Crange%E2%80%9D-%E8%B5%B0%E8%A8%AA%E6%8C%87%E5%AE%9A%E7%89%A9%E4%BB%B6%E7%9A%84%E6%89%80%E6%9C%89%E5%85%83%E7%B4%A0"><span class="nav-number">6.4.</span> <span class="nav-text">使用 “range” 走訪指定物件的所有元素</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Variables"><span class="nav-number">7.</span> <span class="nav-text">Variables</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#scoped-variable"><span class="nav-number">7.1.</span> <span class="nav-text">scoped variable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#global-variable-%E5%BE%85%E8%A3%9C"><span class="nav-number">7.2.</span> <span class="nav-text">global variable (待補)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Named-Templates"><span class="nav-number">8.</span> <span class="nav-text">Named Templates</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#References"><span class="nav-number">9.</span> <span class="nav-text">References</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">godleon</p>
  <div class="site-description" itemprop="description">把時間花在哪裡，成就就在哪裡</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives">
          <span class="site-state-item-count">174</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
        <span class="site-state-item-count">124</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://godleon.github.io/blog/DevOps/Helm-v3-Chart-Template-Guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="godleon">
      <meta itemprop="description" content="把時間花在哪裡，成就就在哪裡">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小信豬的原始部落">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [Helm] Helm v3 使用簡介
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-14 11:00:00" itemprop="dateCreated datePublished" datetime="2020-09-14T11:00:00+08:00">2020-09-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-07-14 16:10:30" itemprop="dateModified" datetime="2023-07-14T16:10:30+08:00">2023-07-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/blog/DevOps/Helm-v3-Chart-Template-Guide/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="DevOps/Helm-v3-Chart-Template-Guide/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <div class="post-description">此篇文章介紹使用 Helm v3 管理 Kubernetes workloads</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="安裝-Helm"><a href="#安裝-Helm" class="headerlink" title="安裝 Helm"></a>安裝 Helm</h1><p>因為我自己用 Ubuntu，所以以下就紀錄 Ubuntu 環境中安裝 Helm 的方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ curl https://baltocdn.com/helm/signing.asc | sudo apt-key add -</span><br><span class="line"></span><br><span class="line">$ sudo apt-get install apt-transport-https --<span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;deb https://baltocdn.com/helm/stable/debian/ all main&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/helm-stable-debian.list</span><br><span class="line"></span><br><span class="line">$ sudo apt-get update</span><br><span class="line"></span><br><span class="line">$ sudo apt-get -y install helm</span><br></pre></td></tr></table></figure>

<p>其他環境的安裝方式可以參考 <a target="_blank" rel="noopener" href="https://helm.sh/docs/intro/install/">Helm 官方安裝文件</a></p>
<h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><h2 id="Chart-基本結構"><a href="#Chart-基本結構" class="headerlink" title="Chart 基本結構"></a>Chart 基本結構</h2><p>Helm chart 是在 <a target="_blank" rel="noopener" href="https://helm.sh/docs/topics/architecture/">Helm 的整體架構</a>中被用來佈署的單位，用 chart 佈署到 k8s 後的產出，稱為 <code>release</code> 或是 <code>released object</code>。</p>
<p>因此 Helm chart 其實就是 k8s 那一堆 API object 的定義 + templating 功能，而衍生來可以管理 k8s workload 發佈的工具，因此先來了解一下 Helm chart 的結構如下：(假設名稱為 <code>mychart</code>)</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mychart/</span><br><span class="line">  Chart.yaml</span><br><span class="line">  values.yaml</span><br><span class="line">  charts/</span><br><span class="line">  templates/</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>templates/</code>：此目錄顧名思義就是存放 template 檔案的位置，佈署時整個目錄會送交到 template rendering engine(目前架構中由 <code>Helm Library</code> 負責此項工作)，搭配其他傳入參數後，產生結果後送給 k8s API server</p>
</li>
<li><p><code>values.yaml</code>：此檔案包含了 <strong>templates/</strong> 目錄中的檔案中所需要的預設值，可讓使用者可以透過 <code>helm install</code> 或是 <code>helm upgrade</code> 來 override，進而產生出不同的 release 內容</p>
</li>
<li><p><code>charts/</code>：此目錄可能包含了其他不同的 chart，也可稱為 <code>subcharts</code></p>
</li>
<li><p><code>Chart.yaml</code>：此檔案包含了 chart 的內容描述</p>
</li>
</ul>
<blockquote>
<p>請注意目錄 &amp; 檔案名稱有大小寫之分</p>
</blockquote>
<h2 id="快速產生-chart-template"><a href="#快速產生-chart-template" class="headerlink" title="快速產生 chart template"></a>快速產生 chart template</h2><p>由於 Helm client 可以協助產生 chart skeleton，因此可以透過以下指令很快的產生出一個範本：</p>
<blockquote>
<p>helm create mychart</p>
</blockquote>
<p>接著就會出現以下的檔案結構：</p>
<p><img src="/blog/images/devops/helm_first-chart.png" alt="How Rancher Communicate"></p>
<p>除了上面提到的幾個重要檔案 &amp; 目錄之外，在 <code>templates/</code> 目錄中多了很多檔案，例如：</p>
<ul>
<li><p><code>NOTES.txt</code>：chart 本身的 help text，當使用者執行 <code>helm install</code> 時會顯示</p>
</li>
<li><p><code>deployment.yaml</code>：建立 k8s deployment 的基本樣板</p>
</li>
<li><p><code>service.yaml</code>：建立 k8s service 的基本樣板</p>
</li>
<li><p><code>_helpers.tpl</code>：用來產生 help 資訊的基本樣板</p>
</li>
</ul>
<h2 id="建立新的-namespace-進行開發測試"><a href="#建立新的-namespace-進行開發測試" class="headerlink" title="建立新的 namespace 進行開發測試"></a>建立新的 namespace 進行開發測試</h2><p>首先建立一個新的 namespace 來進行後續的開發測試：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 顯示目前有哪些 context</span></span><br><span class="line">$ kubectl config get-contexts</span><br><span class="line">CURRENT   NAME                                      CLUSTER                                   AUTHINFO             NAMESPACE</span><br><span class="line">*         my-vsphere-cluster                        my-vsphere-cluster                        my-vsphere-cluster   </span><br><span class="line">          my-vsphere-cluster-rancher-k8s-master-1   my-vsphere-cluster-rancher-k8s-master-1   my-vsphere-cluster   </span><br><span class="line">          my-vsphere-cluster-rancher-k8s-master-2   my-vsphere-cluster-rancher-k8s-master-2   my-vsphere-cluster   </span><br><span class="line">          my-vsphere-cluster-rancher-k8s-master-3   my-vsphere-cluster-rancher-k8s-master-3   my-vsphere-cluster</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立 namespace</span></span><br><span class="line">$ kubectl create ns/helm-test</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切換目前 context 所使用的 default namespace</span></span><br><span class="line">$ kubectl config set-context my-vsphere-cluster --namespace=helm-test</span><br></pre></td></tr></table></figure>


<h2 id="建立第一個-template"><a href="#建立第一個-template" class="headerlink" title="建立第一個 template"></a>建立第一個 template</h2><p>首先為了讓事情簡單點，先移除 <code>templates/</code> 目錄中的所有內容，並建立以下檔案：(<code>templates/configmap.yaml</code>)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># &#123;&#123; .Release.Name &#125;&#125; 表示要置換為 Release 物件中的 Name 屬性</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>開發 chart 時，檔案的副檔名規則，建議若是 YAML 使用 <code>.yaml</code>，若是 help 資訊相關的則用 <code>.tpl</code></p>
</blockquote>
<p>接著執行安裝 Helm chart 的動作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ helm install clunky-serval ./mychart</span><br><span class="line">NAME: clunky-serval</span><br><span class="line">LAST DEPLOYED: Sat Mar 21 20:22:23 2020</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br></pre></td></tr></table></figure>

<p>接著可以用以下指令檢視 release 的詳細內容 &amp; 實際上佈署到 k8s 的設定：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># configmap 的名稱套用了 release name</span></span><br><span class="line">$ kubectl get configmap</span><br><span class="line">NAME                      DATA   AGE</span><br><span class="line">clunky-serval-configmap   1      10s</span><br><span class="line"></span><br><span class="line">$ helm get manifest clunky-serval</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: clunky-serval-configmap</span><br><span class="line">data:</span><br><span class="line">  myvalue: <span class="string">&quot;Hello World&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>若 chart 中多個 k8s API object 的定義，上面就會一併顯示出來</p>
</blockquote>
<p>最後執行移除 chart 的指令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ helm uninstall clunky-serval</span><br><span class="line">release <span class="string">&quot;clunky-serval&quot;</span> uninstalled</span><br></pre></td></tr></table></figure>

<p>此外，若是希望可以檢視準備要安裝的 chart 內容再決定是否安裝，可執行以下指令，透過 template 產生出預計會安裝到 k8s 的內容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 若 --dry-run 之前加上 --debug 可以獲得更多資訊</span></span><br><span class="line">$ helm install --dry-run goodly-guppy ./mychart</span><br><span class="line">NAME: goodly-guppy</span><br><span class="line">LAST DEPLOYED: Sat Mar 21 20:27:45 2020</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: pending-install</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">HOOKS:</span><br><span class="line">MANIFEST:</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: goodly-guppy-configmap</span><br><span class="line">data:</span><br><span class="line">  myvalue: <span class="string">&quot;Hello World&quot;</span></span><br></pre></td></tr></table></figure>

<p>透過 <code>--dry-run</code> 可以檢視準備要安裝到 k8s 的內容，但卻不會進行真正的安裝，在開發 chart 時是個非常好用的功能。</p>
<h1 id="Built-in-Objects"><a href="#Built-in-Objects" class="headerlink" title="Built-in Objects"></a>Built-in Objects</h1><p>Object 是在 template engine 中傳遞給 template，產生出最終結果用的；而 Helm 提供了很多可程式化的方式來產生 object。</p>
<p>以上面的範例來說，就是使用了 Release object 中的 Name 屬性(官方文件中依然將 Name 視為 object)，因此透過 <code>&#123;&#123; .Release.Name &#125;&#125;</code> 的方式就可以變更 configmap 的名稱。</p>
<p>以下介紹幾個內建的 object：(<strong>以下內建的 object 都是以大寫字母開頭命名，自訂物件可不用按照此規則</strong>)</p>
<h2 id="Release"><a href="#Release" class="headerlink" title="Release"></a>Release</h2><p>很直觀的，Release object 其實就是描述 release 本身，包含了像是 <code>Release.Name</code>, <code>Release.Namespace</code>, <code>Release.IsUpgrade</code>, <code>Release.IsInstall</code>, <code>Release.Revision</code>, <code>Release.Service</code>…等屬性(or object)。</p>
<h2 id="Values"><a href="#Values" class="headerlink" title="Values"></a>Values</h2><p>這個 object 的值則是直接來自於使用者佈署時所傳入的 <code>values.yaml</code> 檔案內容；若是沒有傳入 <code>values.yaml</code>，那 Values 這個 object 就不會有任何內容。</p>
<h2 id="Chart"><a href="#Chart" class="headerlink" title="Chart"></a>Chart</h2><p>這個 object 的內容來自於檔案 <code>Chart.yaml</code> 中所定義的內容，例如：<code>Chart.Name</code> &amp; <code>Chart.Version</code></p>
<h2 id="Files"><a href="#Files" class="headerlink" title="Files"></a>Files</h2><p>Files object 是用來協助存取上述特殊檔案以外的檔案，舉例來說：</p>
<ul>
<li><p><code>Files.Get</code>：可用來取得指定路徑的檔案</p>
</li>
<li><p><code>Files.GetBytes</code>：從檔案中取得 binary 的內容，通常用來處理像是 image 這一類的檔案</p>
</li>
<li><p><code>Files.Lines</code>：可以針對檔案內容一行一行的逐行讀取，常用來以 <code>line</code> 為單位進行處理時使用</p>
</li>
<li><p><code>Files.AsSecrets</code>：讀取檔案內容後，轉成以 Base 64 編碼後的內容</p>
</li>
<li><p><code>Files.AsConfig</code>：將檔案內容轉換成 YAML map 物件</p>
</li>
</ul>
<h2 id="Capabilities"><a href="#Capabilities" class="headerlink" title="Capabilities"></a>Capabilities</h2><p>此物件用來提供目前 k8s cluster 所具備的功能範圍資訊，例如：<code>Capabilities.APIVersions</code>, <code>Capabilities.APIVersions.Has $version</code>, <code>Capabilities.KubeVersion</code>, <code>Capabilities.KubeVersion.Major</code>, <code>Capabilities.KubeVersion.Minor</code> … 等資訊。</p>
<h2 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h2><p>此物件提供目前執行中的 template 所包含的訊息，例如：</p>
<ul>
<li><p><code>Name</code>：template 在 chart 中的相對路徑，例如：<code>mychart/templates/mytemplate.yaml</code></p>
</li>
<li><p><code>BasePath</code>：此 template 位於 chart 中的相對路徑，例如：<code>mychart/templates</code></p>
</li>
</ul>
<h1 id="Values-檔案的使用方式"><a href="#Values-檔案的使用方式" class="headerlink" title="Values 檔案的使用方式"></a>Values 檔案的使用方式</h1><h2 id="標準使用方式"><a href="#標準使用方式" class="headerlink" title="標準使用方式"></a>標準使用方式</h2><p>透過傳遞 Values 檔案的內容，使用者可以根據需求改變 Helm chart 產生出的內容，將正確的內容佈署到 k8s 上，而 Values 檔案在套用上的順序，會按照以下的順序來套用：(越下方的優先權越高)</p>
<ul>
<li><p>chart 中所包含的 <code>values.yaml</code> 檔案</p>
</li>
<li><p>若有 subchart，則會套用來自 parent chart 的 <code>values.yaml</code></p>
</li>
<li><p>使用 <code>helm install -f</code> or <code>helm upgrade -f</code> 時指定的檔案，例如：<code>helm install -f myvals.yaml ./mychart</code></p>
</li>
<li><p>透過 <code>--set</code> 傳入的單獨參數，例如：<code>helm install --set foo=bar ./mychart</code></p>
</li>
</ul>
<p>以上面的範例來說，建立檔案 <code>mychart/values.yaml</code>，內容如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br></pre></td></tr></table></figure>

<p><code>mychart/templates/configmap.yaml</code> 的內容則調整如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>以下則是實際用法說明：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以看到 drink 的值出現了來自 values.yaml 中的 coffee</span></span><br><span class="line">$ $ helm install --dry-run good-puppy ./mychart</span><br><span class="line">NAME: good-puppy</span><br><span class="line">LAST DEPLOYED: Sun Mar 22 20:28:11 2020</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: pending-install</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">HOOKS:</span><br><span class="line">MANIFEST:</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: good-puppy-configmap</span><br><span class="line">data:</span><br><span class="line">  myvalue: <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  drink: coffee</span><br><span class="line">  food: pizza</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以透過 --set 直接取代 values.yaml 中的值</span></span><br><span class="line"><span class="comment"># 其中 drink 被 --set 覆蓋了，而 food 則使用 values.yaml 中的值</span></span><br><span class="line">$ $ helm install --dry-run --<span class="built_in">set</span> favorite.drink=slurm good-puppy ./mychart</span><br><span class="line">NAME: good-puppy</span><br><span class="line">LAST DEPLOYED: Sun Mar 22 20:29:16 2020</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: pending-install</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">HOOKS:</span><br><span class="line">MANIFEST:</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: good-puppy-configmap</span><br><span class="line">data:</span><br><span class="line">  myvalue: <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  drink: slurm</span><br><span class="line">  food: pizza</span><br></pre></td></tr></table></figure>

<h2 id="若要刪除-default-key"><a href="#若要刪除-default-key" class="headerlink" title="若要刪除 default key"></a>若要刪除 default key</h2><p>待測試…..</p>
<h1 id="Template-Functions-and-Pipelines"><a href="#Template-Functions-and-Pipelines" class="headerlink" title="Template Functions and Pipelines"></a>Template Functions and Pipelines</h1><p>此部份介紹如何根據實際需求，將傳入到 template 的值再進行額外的加工；而 Helm 提供了超過六十種的 function 可供使用者處理資料，這些 function 來自於以下兩個地方：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://godoc.org/text/template">Go template language</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://masterminds.github.io/sprig/">Sprig template library</a></p>
</li>
</ul>
<p>以下舉個簡單例子：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="comment"># 範例中的 quote function，可以為傳入的值增加雙引號</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">quote</span> <span class="string">.Values.favorite.drink</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">quote</span> <span class="string">.Values.favorite.food</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Pipelines"><a href="#Pipelines" class="headerlink" title="Pipelines"></a>Pipelines</h2><p>pipeline 是來自於 Unix 的概念，在 templating language 是時常被用到的功能，可將多個 function 同時混搭使用，例如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="comment"># 透過 pipeline 來套用 quote function</span></span><br><span class="line">  <span class="comment"># 也可以多個 function 混搭使用</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">repeat</span> <span class="number">5</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>以下是上述範例的輸出結果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ helm install --dry-run good-puppy ./mychart/</span><br><span class="line">NAME: good-puppy</span><br><span class="line">LAST DEPLOYED: Mon Mar 23 04:38:51 2020</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: pending-install</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">HOOKS:</span><br><span class="line">MANIFEST:</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: good-puppy-configmap</span><br><span class="line">data:</span><br><span class="line">  myvalue: <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  drink: <span class="string">&quot;coffeecoffeecoffeecoffeecoffee&quot;</span></span><br><span class="line">  food: <span class="string">&quot;PIZZA&quot;</span></span><br></pre></td></tr></table></figure>


<h1 id="Flow-Control"><a href="#Flow-Control" class="headerlink" title="Flow Control"></a>Flow Control</h1><p>flow control 同樣也是 templating language 中的一個重要功能，而 Helm 提供了 <code>if/else</code>, <code>with</code>, <code>range</code> … 等功能，若有對程式開發有經驗的人，看到上述的關鍵字應該可以很容易的理解。</p>
<p>此外，還有其他特別的功能，像是：</p>
<ul>
<li><p><code>define</code>：在 template 中定義 template</p>
</li>
<li><p><code>template</code>：匯入指定的 template</p>
</li>
<li><p><code>block</code>：宣告一個 template 區域</p>
</li>
</ul>
<h2 id="if-else"><a href="#if-else" class="headerlink" title="if/else"></a>if/else</h2><p>在以下的情況下，會被 template engine 判定為 false：</p>
<ul>
<li><p>boolean 值，false</p>
</li>
<li><p>數字，0</p>
</li>
<li><p>空白字串</p>
</li>
<li><p><code>nil</code> (空白字串 or null)</p>
</li>
<li><p>空集合(map, slice, tuple, dict, array)</p>
</li>
</ul>
<p>其他情況則都會被判定為 true。</p>
<p>以下是個簡單範例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;coffee&quot;</span> &#125;&#125;<span class="attr">mug:</span> <span class="literal">true</span>&#123;&#123; <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>會得到下方結果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ helm install --dry-run good-puppy ./mychart/</span><br><span class="line">NAME: good-puppy</span><br><span class="line">LAST DEPLOYED: Mon Mar 23 05:15:03 2020</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: pending-install</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">HOOKS:</span><br><span class="line">MANIFEST:</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: good-puppy-configmap</span><br><span class="line">data:</span><br><span class="line">  myvalue: <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  drink: <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  food: <span class="string">&quot;PIZZA&quot;</span></span><br><span class="line">  mug: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="處理空白字元"><a href="#處理空白字元" class="headerlink" title="處理空白字元"></a>處理空白字元</h2><p>仔細看上面的範例，在 if 那一行看起來就很不習慣，如果改成下面這樣寫法肯定更容易的看懂：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;coffee&quot;</span> &#125;&#125;</span><br><span class="line">  <span class="attr">mug:</span> <span class="literal">true</span></span><br><span class="line">  &#123;&#123; <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>但這樣會造成以下結果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ helm install --dry-run good-puppy ./mychart/</span><br><span class="line">NAME: good-puppy</span><br><span class="line">LAST DEPLOYED: Mon Mar 23 05:16:52 2020</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: pending-install</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">HOOKS:</span><br><span class="line">MANIFEST:</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: good-puppy-configmap</span><br><span class="line">data:</span><br><span class="line">  myvalue: <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  drink: <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  food: <span class="string">&quot;PIZZA&quot;</span></span><br><span class="line">  </span><br><span class="line">  mug: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>結果中間出現了一個空白行，雖然可以正常使用但就是不太好看；幸好 Helm 提供了解決方法：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;coffee&quot;</span> &#125;&#125;</span><br><span class="line">  <span class="attr">mug:</span> <span class="literal">true</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>透過在 if &amp; else 前方加上一個 dash <code>-</code>，就會出現一開始的結果囉!</p>
<h2 id="透過-“with”-關鍵字來限定變數範圍"><a href="#透過-“with”-關鍵字來限定變數範圍" class="headerlink" title="透過 “with” 關鍵字來限定變數範圍"></a>透過 “with” 關鍵字來限定變數範圍</h2><p>有時候當 value 的階層很多時，透過 <code>with</code> 關鍵字就可以讓 template 內容再更簡潔一點，例如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="comment"># 直接將變數範圍限縮在 `.favorite` 中</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">with</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line">  <span class="attr">release:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用-“range”-走訪指定物件的所有元素"><a href="#使用-“range”-走訪指定物件的所有元素" class="headerlink" title="使用 “range” 走訪指定物件的所有元素"></a>使用 “range” 走訪指定物件的所有元素</h2><p><code>range</code>的用法就跟程式語言中的 <code>foreach</code> 是相同的，以下是個範例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">with</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line">  <span class="comment"># 透過 range 處理的資料可以來自於 Values 物件</span></span><br><span class="line">  <span class="attr">toppings:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    &#123;&#123;- range $index, $topping := .Values.pizzaToppings &#125;&#125;</span></span><br><span class="line"><span class="string">    - &#123;&#123; . | title | quote &#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- end &#125;&#125;</span></span><br><span class="line"><span class="string"></span>  <span class="comment"># 也可以直接定義在 template 中</span></span><br><span class="line">  <span class="attr">sizes:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    &#123;&#123;- range tuple &quot;small&quot; &quot;medium&quot; &quot;large&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">    - &#123;&#123; . &#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- end &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 執行結果</span></span><br><span class="line">$ helm install --dry-run good-puppy ./mychart/</span><br><span class="line">NAME: good-puppy</span><br><span class="line">LAST DEPLOYED: Wed Mar 25 05:18:48 2020</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: pending-install</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">HOOKS:</span><br><span class="line">MANIFEST:</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: good-puppy-configmap</span><br><span class="line">data:</span><br><span class="line">  myvalue: <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  drink: <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  food: <span class="string">&quot;PIZZA&quot;</span></span><br><span class="line">  toppings: |-</span><br><span class="line">    - <span class="string">&quot;Mushrooms&quot;</span></span><br><span class="line">    - <span class="string">&quot;Cheese&quot;</span></span><br><span class="line">    - <span class="string">&quot;Peppers&quot;</span></span><br><span class="line">    - <span class="string">&quot;Onions&quot;</span></span><br><span class="line">  sizes: |-</span><br><span class="line">    - small</span><br><span class="line">    - medium</span><br><span class="line">    - large</span><br></pre></td></tr></table></figure>

<p>而 range 可以處理的資料結構其實有不少，除了像是一般的 <code>tuple</code> &amp; <code>list</code> 之外，其他像是 key/value 結構的 <code>map</code> &amp; <code>dict</code> 也都是支援的。</p>
<h1 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h1><h2 id="scoped-variable"><a href="#scoped-variable" class="headerlink" title="scoped variable"></a>scoped variable</h2><p>variable 的概念其實跟一般程式語言中的變數並無不同，其實就是<code>將特定的值塞入變數中，並在後續的程式中使用</code>，以下是從上面改造的範例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="comment"># 定義 variable &quot;$relname&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">$relname</span> <span class="string">:=</span> <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line">  <span class="comment"># 使用 range 搭配 $key &amp; $val 的組合，可以走訪每個 dictionary 元素</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">range</span> <span class="string">$key</span>, <span class="string">$val</span> <span class="string">:=</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">$key</span> &#125;&#125;<span class="string">:</span> &#123;&#123; <span class="string">$val</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line">  <span class="attr">rlease:</span> &#123;&#123; <span class="string">$relname</span> &#125;&#125;</span><br><span class="line">  <span class="comment"># 使用預先定義的 variable</span></span><br><span class="line">  <span class="attr">rlease:</span> &#123;&#123; <span class="string">$relname</span> &#125;&#125;</span><br><span class="line">  <span class="comment"># 使用 range 搭配 index &amp; value 的方式</span></span><br><span class="line">  <span class="comment"># 即可使用每個 value 在集合中對應的 index</span></span><br><span class="line">  <span class="attr">toppings:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    &#123;&#123;- range $index, $topping := .Values.pizzaToppings &#125;&#125;</span></span><br><span class="line"><span class="string">      &#123;&#123; $index &#125;&#125; &#123;&#123; $topping | title | quote &#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- end &#125;&#125;</span></span><br><span class="line"><span class="string"></span>  <span class="attr">sizes:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    &#123;&#123;- range tuple &quot;small&quot; &quot;medium&quot; &quot;large&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">    - &#123;&#123; . &#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- end &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="global-variable-待補"><a href="#global-variable-待補" class="headerlink" title="global variable (待補)"></a>global variable (待補)</h2><h1 id="Named-Templates"><a href="#Named-Templates" class="headerlink" title="Named Templates"></a>Named Templates</h1><p>named template 跟前面看到一般的 template 是不太一樣的，具有以下幾個特性：</p>
<ul>
<li><p>類似 include file 的概念，named template 可透過 <code>include</code> 關鍵字帶入另外一個 template 中</p>
</li>
<li><p>也被稱為 <strong>partial template</strong> 或是 <strong>subtemplate</strong> </p>
</li>
</ul>
<p>其他待補……</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><p><a target="_blank" rel="noopener" href="https://helm.sh/docs/chart_template_guide/getting_started/">Helm | Getting Started</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://helm.sh/docs/chart_template_guide/builtin_objects/">Helm | Built-in Objects</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://helm.sh/docs/chart_template_guide/values_files/">Helm | Values Files</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://helm.sh/docs/chart_template_guide/functions_and_pipelines/">Helm | Template Functions and Pipelines</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://helm.sh/docs/chart_template_guide/control_structures/">Helm | Flow Control</a></p>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/DevOps/" rel="tag"># DevOps</a>
              <a href="/blog/tags/Helm/" rel="tag"># Helm</a>
              <a href="/blog/tags/Kubernetes/" rel="tag"># Kubernetes</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/Architecture_Design/Architecture-Design-HA-Compute/" rel="prev" title="[架構設計] 高可用計算架構">
                  <i class="fa fa-chevron-left"></i> [架構設計] 高可用計算架構
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/Architecture_Design/Architecture-Design-Multiple-Site-HA/" rel="next" title="[架構設計] Multi-Site High Avalibility">
                  [架構設計] Multi-Site High Avalibility <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  



      
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">godleon</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
<script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/schemes/muse.js"></script><script src="/blog/js/next-boot.js"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  















  








    <div class="pjax">
  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://godleon-blog-hexo.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://godleon.github.io/blog/DevOps/Helm-v3-Chart-Template-Guide/";
    this.page.identifier = "DevOps/Helm-v3-Chart-Template-Guide/";
    this.page.title = "[Helm] Helm v3 使用簡介";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://godleon-blog-hexo.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

    </div>
</body>
</html>
