<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"godleon.github.io","root":"/blog/","scheme":"Muse","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false};
  </script>

  <meta name="description" content="此篇文章是學習 Udemy 課程 &quot;AWS Identity Access Management (IAM) Practical Applications&quot; 時，將學習 IAM Policy 相關的重要概念，例如：Policy Structure, Statement ID, Effect, Action, Resource, Condition, Principal ... 等等的過程中整理出來">
<meta property="og:type" content="article">
<meta property="og:title" content="[AWS IAM] 學習重點節錄(2) - IAM Policy">
<meta property="og:url" content="https://godleon.github.io/blog/AWS/learn-AWS-IAM-2-policy/index.html">
<meta property="og:site_name" content="小信豬的原始部落">
<meta property="og:description" content="此篇文章是學習 Udemy 課程 &quot;AWS Identity Access Management (IAM) Practical Applications&quot; 時，將學習 IAM Policy 相關的重要概念，例如：Policy Structure, Statement ID, Effect, Action, Resource, Condition, Principal ... 等等的過程中整理出來">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Action.png">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Resource-ARN.png">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Resource-ARN-format.png">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Policy-Resource-Type.png">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Resource-Types-Actions-mapping.png">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Policy-Condition-1.png">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Policy-Condition-1.png">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Policy-Condition-Format-2-error.png">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Policy-Condition-Format-2-correct.png">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Policy-Condition-Elements-1.png">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Policy-Condition-Key-1.png">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Policy-Condition-Key-2-s3.png">
<meta property="og:image" content="https://godleon.github.io/blog/images/aws/IAM-Resource-Types-Actions-mapping.png">
<meta property="article:published_time" content="2020-12-20T22:40:00.000Z">
<meta property="article:modified_time" content="2021-01-17T03:43:05.681Z">
<meta property="article:author" content="godleon">
<meta property="article:tag" content="AWS">
<meta property="article:tag" content="IAM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://godleon.github.io/blog/images/aws/IAM-Action.png">


<link rel="canonical" href="https://godleon.github.io/blog/AWS/learn-AWS-IAM-2-policy/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>[AWS IAM] 學習重點節錄(2) - IAM Policy | 小信豬的原始部落</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-703592-7"></script>
    <script data-pjax>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-703592-7');
      }
    </script>






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">小信豬的原始部落</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#IAM-Policy-%E7%B0%A1%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">IAM Policy 簡介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Overview"><span class="nav-number">1.1.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Policy-Type"><span class="nav-number">1.2.</span> <span class="nav-text">Policy Type</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IAM-Policy-Structure"><span class="nav-number">2.</span> <span class="nav-text">IAM Policy Structure</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Statement-ID-Sid"><span class="nav-number">3.</span> <span class="nav-text">Statement ID (Sid)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Effect"><span class="nav-number">4.</span> <span class="nav-text">Effect</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Action"><span class="nav-number">5.</span> <span class="nav-text">Action</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">5.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AF%8F%E5%80%8B%E6%9C%8D%E5%8B%99%E5%88%B0%E5%BA%95%E6%9C%89%E5%93%AA%E4%BA%9B-Action-%E5%8F%AF%E7%94%A8"><span class="nav-number">5.2.</span> <span class="nav-text">每個服務到底有哪些 Action 可用 ?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E6%9B%B4%E6%96%B9%E4%BE%BF%E6%92%B0%E5%AF%AB-Action"><span class="nav-number">5.3.</span> <span class="nav-text">如何更方便撰寫 Action ?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E7%89%B9%E6%80%A7"><span class="nav-number">5.4.</span> <span class="nav-text">其他特性</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Resources"><span class="nav-number">6.</span> <span class="nav-text">Resources</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Amazon-Resource-Name"><span class="nav-number">6.1.</span> <span class="nav-text">Amazon Resource Name</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ARN-Format"><span class="nav-number">6.2.</span> <span class="nav-text">ARN Format</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%AF%AB%E5%87%BA%E5%AE%8C%E6%95%B4-amp-%E6%AD%A3%E7%A2%BA%E7%9A%84-ARN"><span class="nav-number">6.3.</span> <span class="nav-text">如何寫出完整 &amp; 正確的 ARN ?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E6%90%9E%E6%B8%85%E6%A5%9A-Action-amp-Resource-%E7%9A%84%E5%B0%8D%E6%87%89%E9%97%9C%E4%BF%82"><span class="nav-number">6.4.</span> <span class="nav-text">如何搞清楚 Action &amp; Resource 的對應關係 ?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Resource-Types"><span class="nav-number">6.4.1.</span> <span class="nav-text">Resource Types</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Actions"><span class="nav-number">6.4.2.</span> <span class="nav-text">Actions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Condition-Keys"><span class="nav-number">6.4.3.</span> <span class="nav-text">Condition Keys</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Conditions"><span class="nav-number">7.</span> <span class="nav-text">Conditions</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B0%A1%E4%BB%8B"><span class="nav-number">7.1.</span> <span class="nav-text">簡介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%92%B0%E5%AF%AB-Condition-%E7%9A%84%E8%A6%8F%E7%AF%84"><span class="nav-number">7.2.</span> <span class="nav-text">撰寫 Condition 的規範</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Condition-Format"><span class="nav-number">7.3.</span> <span class="nav-text">Condition Format</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Condition-Operator"><span class="nav-number">7.3.1.</span> <span class="nav-text">Condition Operator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Condition-Key"><span class="nav-number">7.3.2.</span> <span class="nav-text">Condition Key</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Global-Key"><span class="nav-number">7.3.2.1.</span> <span class="nav-text">Global Key</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Service-Key"><span class="nav-number">7.3.2.2.</span> <span class="nav-text">Service Key</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E6%92%B0%E5%AF%AB%E6%AD%A3%E7%A2%BA%E7%9A%84-Condition-%E5%85%A7%E5%AE%B9"><span class="nav-number">7.4.</span> <span class="nav-text">如何撰寫正確的 Condition 內容?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AF%84%E4%BE%8B"><span class="nav-number">7.5.</span> <span class="nav-text">範例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Principal"><span class="nav-number">8.</span> <span class="nav-text">Principal</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#References"><span class="nav-number">9.</span> <span class="nav-text">References</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">godleon</p>
  <div class="site-description" itemprop="description">把時間花在哪裡，成就就在哪裡</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives">
          <span class="site-state-item-count">153</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
        <span class="site-state-item-count">108</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://godleon.github.io/blog/AWS/learn-AWS-IAM-2-policy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="godleon">
      <meta itemprop="description" content="把時間花在哪裡，成就就在哪裡">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小信豬的原始部落">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [AWS IAM] 學習重點節錄(2) - IAM Policy
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-21 06:40:00" itemprop="dateCreated datePublished" datetime="2020-12-21T06:40:00+08:00">2020-12-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-17 11:43:05" itemprop="dateModified" datetime="2021-01-17T11:43:05+08:00">2021-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/AWS/" itemprop="url" rel="index"><span itemprop="name">AWS</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/blog/AWS/learn-AWS-IAM-2-policy/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="AWS/learn-AWS-IAM-2-policy/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <div class="post-description">此篇文章是學習 Udemy 課程 "AWS Identity Access Management (IAM) Practical Applications" 時，將學習 IAM Policy 相關的重要概念，例如：Policy Structure, Statement ID, Effect, Action, Resource, Condition, Principal ... 等等的過程中整理出來的重點知識 & 正確使用方式</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="IAM-Policy-簡介"><a href="#IAM-Policy-簡介" class="headerlink" title="IAM Policy 簡介"></a>IAM Policy 簡介</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>簡單來說，IAM Policy 的目的就是要管控”<strong>在你帳號(root account)底下的使用者能做些什麼事情</strong>“，當然前面就需要包含 Authenticate &amp; Authorization 的過程</p>
<p>透過 AWS console，可以看到很多 pre-defined 的 IAM policy，並且可以看到以 JSON format 輸出的格式，而要自定義 IAM policy，也同樣是要提供 JSON 的定義來完成 </p>
<h2 id="Policy-Type"><a href="#Policy-Type" class="headerlink" title="Policy Type"></a>Policy Type</h2><p>IAM Policy 有兩種類型：</p>
<ol>
<li><p>使用者自行開發的 policy，稱為 <strong>Customer Managed Policy</strong>，使用者可以自行建立、編輯、刪除</p>
</li>
<li><p>另外一種則是 AWS 預先定義好提供給 user 的 policy，稱為 <strong>AWS Managed Policy</strong>，只有提供 read only 的權限</p>
</li>
</ol>
<p>因此若是 AWS 有發佈新的服務，就自然會有相對應的 IAM policy 被定義出來，提供給使用者方便使用。</p>
<h1 id="IAM-Policy-Structure"><a href="#IAM-Policy-Structure" class="headerlink" title="IAM Policy Structure"></a>IAM Policy Structure</h1><p>以下透過一個範例來簡單介紹 IAM Policy structure：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;Version&quot;</span>: <span class="string">&quot;2012-10-17&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;Statement&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;Sid&quot;</span>: <span class="string">&quot;MyListBucketStatement&quot;</span>, </span><br><span class="line">      <span class="attr">&quot;Effect&quot;</span>: <span class="string">&quot;Allow&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;Action&quot;</span>: <span class="string">&quot;s3:ListBucket&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;Resource&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;arn:aws:s3:::com.test.demo.file&quot;</span></span><br><span class="line">        <span class="string">&quot;arn:aws:s3:::com.test.demo.images&quot;</span></span><br><span class="line">        <span class="string">&quot;arn:aws:s3:::com.test.demo.notes&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中有幾個重要部份：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_version.html"><code>Version</code></a>：用來告知 AWS 是使用哪個 Language Syntax rule (基本上使用新的版本)</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_statement.html"><code>Statement</code></a>：主要用來定義允許(or 拒絕)對哪些 AWS resource 進行操作</p>
</li>
</ul>
<p>還有一些重要事項需要提醒：</p>
<ul>
<li><p>所有的關鍵字(Version, Statement, Sid … etc)都是有分大小寫的，寫錯會不可用</p>
</li>
<li><p>仔細看一下 Statement 的結構，它是一個 array，因此可以包含多個 sub statement</p>
</li>
</ul>
<p>此外，<strong>Statement Element</strong> 一共有九種，分別是：</p>
<ol>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_sid.html">Sid</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_effect.html">Effect</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_principal.html">Principal</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_notprincipal.html">NotPrincipal</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_action.html">Action</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_notaction.html">NotAction</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_resource.html">Resource</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_notresource.html">NotResource</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_condition.html">Condition</a></p>
</li>
</ol>
<h1 id="Statement-ID-Sid"><a href="#Statement-ID-Sid" class="headerlink" title="Statement ID (Sid)"></a><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_sid.html">Statement ID (Sid)</a></h1><ul>
<li><p>Sid 是選填的(optional)，因此不填也是可以的</p>
</li>
<li><p>Sid 若是填了，就必須要確定在同一個 JSON document 中的 Sid 是不能重複的</p>
</li>
<li><p>Sid 其實可以拿來作為識別該 policy 的用途</p>
</li>
<li><p>Case sensitive，因此只要大小寫不同就會被視為不同的 Sid</p>
</li>
</ul>
<h1 id="Effect"><a href="#Effect" class="headerlink" title="Effect"></a><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_effect.html">Effect</a></h1><ul>
<li><p>Effect 只會有兩個值，<code>Deny</code> &amp; <code>Allow</code></p>
</li>
<li><p>AWS 預設的 Effect 是 <code>Deny</code>，除非明確指定 <code>Allow</code> 才會是 Allow 的效果</p>
</li>
<li><p>policy 中的每個 statement 都必須要定義 <code>Effect</code></p>
</li>
<li><p>如果同時有 Allow &amp; Deny effect 套用在同一個 resource，那效果就會是 deny</p>
</li>
</ul>
<h1 id="Action"><a href="#Action" class="headerlink" title="Action"></a><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_action.html">Action</a></h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>Action 基本上就是要清楚說明：<strong>在那一個 AWS resource 上，可以做哪些事情?</strong></p>
<p><img src="/blog/images/aws/IAM-Action.png" alt="IAM Action"></p>
<p>從上圖來說明：</p>
<ul>
<li><p><code>resource</code>：指定 AWS resource</p>
</li>
<li><p><code>verb</code>：可以做什麼事情</p>
</li>
</ul>
<blockquote>
<p>因此上面就表示，可以對 S3 服務進行 ListBucket 的操作</p>
</blockquote>
<h2 id="每個服務到底有哪些-Action-可用"><a href="#每個服務到底有哪些-Action-可用" class="headerlink" title="每個服務到底有哪些 Action 可用 ?"></a>每個服務到底有哪些 Action 可用 ?</h2><p>有了 resource &amp; verb 的概念後，另外一個問題來了 =&gt; AWS 服務這個多，那每個服務可用的 action 有哪些呢?</p>
<p>這部份肯定沒有人會去背下來，因此可以查詢<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/service-authorization/latest/reference/reference_policies_actions-resources-contextkeys.html">官網文件 “Actions, resources, and condition keys for AWS services - Service Authorization Reference”</a> 得到解答，例如剛剛 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazons3.html">S3:ListBucket</a> 的例子：</p>
<ul>
<li><p><strong>resource</strong>：出現在文件的第一行 “service prefix: <code>s3</code>“，因此可以知道關鍵字就是 <code>s3</code></p>
</li>
<li><p><strong>verb</strong>：文件往下移動，就可以看到 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazons3.html#amazons3-actions-as-permissions"><code>Actions defined by Amazon S3</code></a>，就可以看到有哪些 verb 可以使用</p>
</li>
</ul>
<p>因此了解如何查詢官方文件，可以少記很多其實沒必要的東西，只要記住重要的事情即可!</p>
<h2 id="如何更方便撰寫-Action"><a href="#如何更方便撰寫-Action" class="headerlink" title="如何更方便撰寫 Action ?"></a>如何更方便撰寫 Action ?</h2><p>如果我們要設定的 Action 很多怎麼辦? 一個一個寫要寫很久的! 那這個時候就可以透過 <strong>wildcard</strong> 來幫忙這件事情，以下用幾個範例來說明：</p>
<ul>
<li><p><code>s3:*</code>：</p>
</li>
<li><p><code>s3:Get*</code></p>
</li>
<li><p><code>s3:*Bucket*</code></p>
</li>
</ul>
<h2 id="其他特性"><a href="#其他特性" class="headerlink" title="其他特性"></a>其他特性</h2><p>除了上面可用 wildcard 之外，Action 在撰寫上還有其他特性，例如：</p>
<ul>
<li><p>not case sensive</p>
</li>
<li><p>可以在同一個 Action 定義中，定義多個且不同的 service + verb</p>
</li>
</ul>
<p>因此我們可以這樣調整：</p>
<ul>
<li><p><code>s3:Get*</code> 與 <code>s3:get*</code> 是相同的</p>
</li>
<li><p><code>[s3:Get*, ec2:Attach]</code>：一次可以定義多個 Action</p>
</li>
<li><p><code>*</code>: 允許在所有 AWS resource(service) 上進行所有操作(verb)</p>
</li>
</ul>
<h1 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h1><p>以上面的 S3 為例，當你建立了一個 bucket 之後，這個 bucket 就是一個 resource；接著又上傳了幾個檔案到 bucket 中，這幾個檔案也是一種 resource。</p>
<p>因此另一個問題就來了：<strong>到底我們可以對哪些 AWS resource 進行操作? 要如何明確的定位這些 resource 呢?</strong></p>
<p>於是就有了下面的篇幅來說明這些事情：</p>
<h2 id="Amazon-Resource-Name"><a href="#Amazon-Resource-Name" class="headerlink" title="Amazon Resource Name"></a>Amazon Resource Name</h2><p>為了明確的定位到特定的 resource，AWS 提出了 Amazon Resource Name(ARN) 用來為每一個 resource 建立一個獨一無二的名稱之用。</p>
<p><img src="/blog/images/aws/IAM-Resource-ARN.png" alt="IAM Resource - ARN"></p>
<p>以上圖為例，就很明確的定義出，此 policy <strong>允許在 “arn:aws:s3:::com.test.demo.file”, “arn:aws:s3:::com.test.demo.images”、”arn:aws:s3:::com.test.demo.notes” 三個 bucket 上進行 ListBucket 的操作</strong>。</p>
<p>此外，ARN 的內容設定上會有一些重點需要了解：</p>
<ul>
<li><p>ARN 的定義也可以跟 Action 一樣使用 wildcard(<code>*</code> &amp; <code>?</code>) 來進行設定，例如：<code>&quot;Resource&quot;: &quot;*&quot;</code> 表示目標是所有的 AWS resource</p>
</li>
<li><p>Resource 的定義是 case sensitive，因此要注意大小寫是有差別的</p>
</li>
<li><p>policy 調整後生效可能會需要一點時間，可能從幾秒鐘甚至到一分鐘不等</p>
</li>
</ul>
<h2 id="ARN-Format"><a href="#ARN-Format" class="headerlink" title="ARN Format"></a>ARN Format</h2><p>ARN 的設計目的是要定位到任何特定的 resource，而 ARN 的命名是把不同的服務、不同的 region、不同的使用者帳號這些事情都考慮進來後所設計出來的，因此就需要針對很多面向拆分出對應的資訊，以下是一個標準的 ARN format：</p>
<blockquote>
<p>arn:partition:service:region:account-id:resource-id</p>
</blockquote>
<ul>
<li><p>識別資訊是透過 “:”(冒號) 分隔的</p>
</li>
<li><p><code>arn</code> &amp; <code>partition</code>：所有的 ARN 都是以 <code>arn</code> 開頭，partition 都是 <code>aws</code></p>
</li>
<li><p><code>service</code>：這部份則是來自於 service prefix，這個資訊在上面提供的 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/service-authorization/latest/reference/reference_policies_actions-resources-contextkeys.html">AWS 官網文件</a> 找到每一個 AWS service 所對應到的 service prefix 是什麼</p>
</li>
<li><p><code>region</code>：這是 region ID，這資訊同樣也是可以到 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.RegionsAndAvailabilityZones.html">AWS 官網文件</a> 找到，以 <strong>Asia Pacific (Tokyo)</strong> 為例，region ID 就是 <code>ap-northeast-1</code></p>
<blockquote>
<p>如果是屬於 global service(例如：<strong>S3</strong>)，這個資訊在 ARN 中就不會需要，因此在兩個 <code>:</code> 之間就啥也都不要寫就行</p>
</blockquote>
</li>
<li><p><code>account-id</code>：進入 AWS console，在畫面右上角點選自己的帳號，就會從下拉選單中看到自己的 Account ID</p>
<blockquote>
<p>有些服務不需要這資訊，例如：<strong>S3</strong>，那表示方法也就是在兩個 <code>:</code> 之間就啥也都不要寫就行</p>
</blockquote>
</li>
<li><p><code>resource-id</code>：這個就是指定 resource 本身了，同時也可以透過 <code>path</code> 的方式來指定更明確的 resource(以下圖為例，透過 path 的方式，可以設定細到 object level 的 ARN)</p>
</li>
</ul>
<p><img src="/blog/images/aws/IAM-Resource-ARN-format.png" alt="IAM Resource ARN format"></p>
<p>更細膩的 AWS resource 表示方法也是有的，搭配 wildcard(<code>*</code> &amp; <code>?</code>) 可以有下面幾種範例：</p>
<ul>
<li><p><code>&quot;Resource&quot;: &quot;arn:aws:s3:::com.my.bucket.*&quot;</code>：指定以 <code>com.my.bucket.</code> 開頭的 bucket &amp; object</p>
</li>
<li><p><code>&quot;Resource&quot;: &quot;arn:aws:s3:::com.my.bucket.*s&quot;</code>：指定以 <code>com.my.bucket.</code> 開頭，<code>s</code> 字元結尾的 bucket</p>
</li>
<li><p><code>&quot;Resource&quot;: &quot;arn:aws:s3:::*&quot;</code>：所有 S3 bucket &amp; object</p>
</li>
</ul>
<p>如果有學過 regular expression，就會知道 <code>?</code> 表示單一字元， 因此搭配 <code>?</code> 的範例就不特別再列了。</p>
<h2 id="如何寫出完整-amp-正確的-ARN"><a href="#如何寫出完整-amp-正確的-ARN" class="headerlink" title="如何寫出完整 &amp; 正確的 ARN ?"></a>如何寫出完整 &amp; 正確的 ARN ?</h2><p>基本上在 AWS console 中，大多數 resource 的 ARN 都可以直接從網頁上複製下來；但如果需要額外加 path 來指定的(例如：S3 object)，那就要知道 object path 才可以指定到正確的 resource。</p>
<p>而若是要清楚了解到底不同的 AWS resource ARN 要怎麼撰寫，可以參考以下兩個文件：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html">Amazon Resource Names (ARNs) - AWS General Reference</a> 取得更多資訊。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/service-authorization/latest/reference/reference_policies_actions-resources-contextkeys.html">Actions, resources, and condition keys for AWS services - Service Authorization Reference</a></p>
</li>
</ul>
<p>上面兩個文件是作為 reference 用，只要了解裡面有什麼資訊，在什麼情況下會需要用到它們，有需要再去查詢即可。</p>
<h2 id="如何搞清楚-Action-amp-Resource-的對應關係"><a href="#如何搞清楚-Action-amp-Resource-的對應關係" class="headerlink" title="如何搞清楚 Action &amp; Resource 的對應關係 ?"></a>如何搞清楚 Action &amp; Resource 的對應關係 ?</h2><p>了解 Action &amp; Resource 之後，接下來的問題就是，<strong>要怎麼搞清楚每個 resource 可以對應到哪些 action 呢?</strong></p>
<p>有些 Action 很容易猜的出來，例如：<code>s3:ListBucket</code>，這很明顯一看就知道這 action 所影響的對象是 S3 bucket，但有時候遇到不熟的 service or Action 名稱定義上不清楚時，就會需要查文件了，此時以下文件可以幫到不少忙：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/service-authorization/latest/reference/reference_policies_actions-resources-contextkeys.html">Actions, resources, and condition keys for AWS services - Service Authorization Reference</a></p>
</blockquote>
<p>看上面的文件要搞清楚三個重要的部份：</p>
<ul>
<li><p>Resource Types</p>
</li>
<li><p>Actions</p>
</li>
<li><p>Condition Keys</p>
</li>
</ul>
<p>以下就以 S3 的參考文件為例：</p>
<h3 id="Resource-Types"><a href="#Resource-Types" class="headerlink" title="Resource Types"></a>Resource Types</h3><p><img src="/blog/images/aws/IAM-Policy-Resource-Type.png" alt="IAM policy resource types - S3"></p>
<p>可以看到目前 S3 服務中一共有五種 resource type，其中 bucket &amp; object 是最常見的兩種，但在其他情況下可能也會使用到另外三種。</p>
<p>此外，還可以從 <code>ARN</code> 欄位中看到要表達該 Resource Type，ARN format 應該會是長成什麼樣子。</p>
<h3 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h3><p>接下來的問題是：<strong>每一個 resource type 可對應到的 Actions 有哪些呢?</strong></p>
<p>在同一份文件中，點選右邊的 <code>Actions</code>，可以找到每個 Action 對應到的是哪個 Resource Type 的資訊，以下圖為例：</p>
<p><img src="/blog/images/aws/IAM-Resource-Types-Actions-mapping.png" alt="IAM policy mapping of Resource Types &amp; Actions  - S3"></p>
<p>可以很明確的看出每一個 Action 所對應的 Resource Type 是那一個。(例如：Action <code>IAM-Resource-Types-Actions-mapping.png</code> =&gt; Resource Type <code>bucket</code>)</p>
<p>但若是 Resource Type 是空白的，那就表示在 policy 中的 resource 是不需要的指定的，但因為 Resources 是必要欄位，因此要定義成：<code>&quot;Resource&quot;: &quot;*&quot;</code>。</p>
<h3 id="Condition-Keys"><a href="#Condition-Keys" class="headerlink" title="Condition Keys"></a>Condition Keys</h3><p>condition 這個主題很大，所以移動到下一個章節說。</p>
<h1 id="Conditions"><a href="#Conditions" class="headerlink" title="Conditions"></a>Conditions</h1><h2 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h2><p>在前面的設定中，除了設定 Action &amp; Resource 之外，還可以透過 <code>Condition</code> 作為一個強大的手段可以進行複雜條件的設定，這功能就幾乎等同在原本的情況下再多加上 <code>IF</code> 的判斷(而用來判斷的資料依據可以有很多種)，若再加上 Statement 本身可以設定多個 sub statement，各種組合也都有可能被搭配出來。</p>
<p><img src="/blog/images/aws/IAM-Policy-Condition-1.png" alt="IAM policy Condition example"></p>
<p>以上面的範例為例，這個 policy 會被套用在 AWS 使用者名稱完全等於 BOB 的情況下，但<strong>若是名稱等於 Bob 就不會相符了</strong>。</p>
<p>因此這時候衍生出一個問題：在 AWS IAM 中，使用者名稱是沒有分大小寫了，那這樣的判斷明顯無法忠實呈現正確的樣貌，因此就必須要將 <code>StringEquals</code> 改成 <code>StringEqualsIgnoreCase</code>。</p>
<h2 id="撰寫-Condition-的規範"><a href="#撰寫-Condition-的規範" class="headerlink" title="撰寫 Condition 的規範"></a>撰寫 Condition 的規範</h2><p>要寫好 Condition，首先要了解撰寫 Condition 的規則，首先：</p>
<ul>
<li><p><strong>Condition 中是可以放多個條件的</strong> (透過 Array 的設定)：每個條件都是以 <code>AND</code> 來相互關聯<br><img src="/blog/images/aws/IAM-Policy-Condition-1.png" alt="IAM policy Condition format 1"></p>
</li>
<li><p><strong>Condition 的宣告是不能重複的</strong>：例如：<code>StringEquals</code> 的設定不能出現兩次，若有這樣的需求，就必須把過濾條件放在同一個 <code>StringEquals</code> 之下 </p>
</li>
</ul>
<p>以下是錯誤的：</p>
<p><img src="/blog/images/aws/IAM-Policy-Condition-Format-2-error.png" alt="IAM policy Condition format 2 - Error"></p>
<p>要改成下面這樣才是正確的：</p>
<p><img src="/blog/images/aws/IAM-Policy-Condition-Format-2-correct.png" alt="IAM policy Condition format 2 - correct"></p>
<h2 id="Condition-Format"><a href="#Condition-Format" class="headerlink" title="Condition Format"></a>Condition Format</h2><p><img src="/blog/images/aws/IAM-Policy-Condition-Elements-1.png" alt="IAM policy Condition Element - 1"></p>
<p>接著來了解完整的 Condition 的正確結構，如上圖，會有三個部份：</p>
<ul>
<li><p><strong>Condition Operator</strong></p>
</li>
<li><p><strong>Condition Key</strong></p>
</li>
<li><p>condition value (這個就忽略不提了，就是條件值而已)</p>
</li>
</ul>
<h3 id="Condition-Operator"><a href="#Condition-Operator" class="headerlink" title="Condition Operator"></a>Condition Operator</h3><p>第一次看到 condition format，可能會想，到底有哪些 Condition Operator 可以用呢? </p>
<p>這個答案可以直接參考 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_condition_operators.html">AWS 官方文件(IAM JSON policy elements: Condition operators - AWS Identity and Access Management)</a> 得到答案，在文件中，有根據資料來源的型態(string, numberic, date, boolean …. etc) 提供可用的 Condition Operator 的資訊。</p>
<p>以上面的 <code>aws:username</code>(String) 為例，就會有 <code>StringEquals</code>、<code>StringEqualsIgnoreCase</code>、<code>StringLike</code> …. 等等可用。 (可參考<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_condition_operators.html#Conditions_String">此文件連結</a>)</p>
<h3 id="Condition-Key"><a href="#Condition-Key" class="headerlink" title="Condition Key"></a>Condition Key</h3><p><img src="/blog/images/aws/IAM-Policy-Condition-Key-1.png" alt="IAM policy Condition Key - 1"></p>
<p>另外一個接著來的問題是：有哪些 Condition Key 可以用呢? 那跟上面的 Action 的對應關係又是什麼?</p>
<p>首先提到 Condition Key 共有兩種類型，分別是：</p>
<ol>
<li><p>Global Key</p>
</li>
<li><p>Service Key</p>
</li>
</ol>
<h4 id="Global-Key"><a href="#Global-Key" class="headerlink" title="Global Key"></a>Global Key</h4><p>其中 Global Keys 是不論對象是什麼 service or action 都可以使用的，詳細的項目可以參考 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html">AWS 官網文件(AWS global condition context keys - AWS Identity and Access Management)</a> 得到更多資訊。</p>
<p>需要注意的是，並不是所有的 Global Key 都會在任何時候都可以用，有些隨時都可以用(例如：<code>aws:CurrentTime</code>, <code>aws:EpochTime</code>)，有些則是在特定的狀況下才可以使用(例如：<code>aws:MultiFactorAuthAge</code>)，可以參考一下文件中 <code>Availability</code> 的說明得到更詳細的資訊。</p>
<h4 id="Service-Key"><a href="#Service-Key" class="headerlink" title="Service Key"></a>Service Key</h4><p>這個就是跟 Service 直接相關了，每個 Service 有其對應的 Condition Key 可以使用，當然不同的 Service 也會有所不同，而這資訊可以透過 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/service-authorization/latest/reference/reference_policies_actions-resources-contextkeys.html">AWS 官網文件(Actions, resources, and condition keys for AWS services - Service Authorization Reference)</a> 進行查詢。</p>
<p>以下以 S3 為例，從 S3 的服務頁面中可以看到以下資訊：</p>
<p><img src="/blog/images/aws/IAM-Policy-Condition-Key-2-s3.png" alt="IAM policy Condition Key - 2 - S3"></p>
<p>從上表中可以看出來每一個 Condition Key 所對應到的資料類型是什麼，有了正確的資料類型資訊後，就可以找出對應的 Condition Operator 可以用哪些。</p>
<p>接著，每個 Action 有其對應的 Condition Key 可以用，並非任何一個 Action 都可以與任一個 Condition Key 搭配，而這個部份，就要查詢 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazons3.html">S3 文件</a>中 Actions 部份資訊：</p>
<p><img src="/blog/images/aws/IAM-Resource-Types-Actions-mapping.png" alt="IAM policy - Action &amp; Condition Key mapping"></p>
<p>從上表可以看得出來每個 Action 有其對應的 Condition Key，因此每個 Service 所可以用的 Condition Key 就是透過這樣的方式查詢出來的。</p>
<h2 id="如何撰寫正確的-Condition-內容"><a href="#如何撰寫正確的-Condition-內容" class="headerlink" title="如何撰寫正確的 Condition 內容?"></a>如何撰寫正確的 Condition 內容?</h2><p>上面看了這麼多，了解了每個部份的相互關係之後，那要如何撰寫正確的 condition 呢?</p>
<p>其實在每個 Service 的文件中都會有一個 <code>Security</code> 的部份，而在裡面找一下關於 Policy and Permission 這樣的文件，裡面就會有 Condition 的設定說明，以 S3 為例，可以參考<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/amazon-s3-policy-keys.html">此文件</a>，在裡面可以看到很多範例可以根據需求直接修改後使用。</p>
<h2 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;Version&quot;</span>: <span class="string">&quot;2012-10-17&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;Statement&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;Action&quot;</span>: [<span class="string">&quot;s3:ListBucket&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;Effect&quot;</span>: <span class="string">&quot;Allow&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;Resource&quot;</span>: [<span class="string">&quot;arn:aws:s3:::mybucket&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;Condition&quot;</span>: &#123;<span class="attr">&quot;StringLike&quot;</span>: &#123;<span class="attr">&quot;s3:prefix&quot;</span>: [<span class="string">&quot;David/*&quot;</span>]&#125;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;Action&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;s3:GetObject&quot;</span>,</span><br><span class="line">        <span class="string">&quot;s3:PutObject&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;Effect&quot;</span>: <span class="string">&quot;Allow&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;Resource&quot;</span>: [<span class="string">&quot;arn:aws:s3:::mybucket/David/*&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<ul>
<li><p>可以對 <strong>arn:aws:s3:::mybucket</strong> bucket 中，prefix 為 David 的執行 List Bucket 的操作</p>
</li>
<li><p>可以對 <strong>arn:aws:s3:::mybucket/David</strong> 這個 bucket 的 object 進行 GET &amp; PUT 的操作</p>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;Version&quot;</span>: <span class="string">&quot;2012-10-17&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;Statement&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;Action&quot;</span>: [<span class="string">&quot;s3:ListBucket&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;Effect&quot;</span>: <span class="string">&quot;Allow&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;Resource&quot;</span>: [<span class="string">&quot;arn:aws:s3:::mybucket&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;Condition&quot;</span>: &#123;<span class="attr">&quot;StringLike&quot;</span>: &#123;<span class="attr">&quot;s3:prefix&quot;</span>: [<span class="string">&quot;$&#123;aws:username&#125;/*&quot;</span>]&#125;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;Action&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;s3:GetObject&quot;</span>,</span><br><span class="line">        <span class="string">&quot;s3:PutObject&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;Effect&quot;</span>: <span class="string">&quot;Allow&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;Resource&quot;</span>: [<span class="string">&quot;arn:aws:s3:::mybucket/$&#123;aws:username&#125;/*&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>效果同上，只是上面這個 policy 只限定針對帶有自己帳號的 bucket 有效，而非 David</p>
</blockquote>
<h1 id="Principal"><a href="#Principal" class="headerlink" title="Principal"></a>Principal</h1><ul>
<li><p>首先搞清楚 policy 有分兩種：<code>User Based Policy</code>(這個是要套用在使用者身上) &amp; <code>Resource Based Policy</code>(這是要套用在 AWS resource 身上)</p>
</li>
<li><p>在 user based policy 中，是無法設定 principal 的，因為這一類的 policy 要透過 attach 的方式發生效果，因此放入 principal 資訊自然也就不合理</p>
</li>
<li><p>正確的用法是要將 principal 套用在 <code>Resource Based Policy</code> 上 (例如：<strong>S3 Bucket Policy</strong>)</p>
</li>
<li><p>只要有任何一種 policy 跟特定使用者有關，就會對它生效(例如：Resource Based Policy 中允許 Bob 讀取 S3 資料，即使 Bob 沒有與任何 User Based Policy 關聯，還是有權限可以存取 S3)</p>
</li>
<li><p>甚至可以將 principal 設定成另外一個 Account ID 的使用者 (但對方對特定的 AWS resource 也有要相對應的權限才行)</p>
<blockquote>
<p>例如：設定一的 S3 bucket policy，同時允許帳號 A 的 Bob &amp; Alice 以及帳號 B 的 John 進行存取，但若是 John 本身沒有存取 S3 的權限也是不行，必須要確保 John 本身有 S3 的存取權限才可以使用該 S3 bucket</p>
</blockquote>
</li>
</ul>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><p><a target="_blank" rel="noopener" href="https://www.udemy.com/course/aws-identity-access-management-practical-applications/">AWS Identity Access Management (IAM) Practical Applications | Udemy</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html">Amazon Resource Names (ARNs) - AWS General Reference</a> 取得更多資訊。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/service-authorization/latest/reference/reference_policies_actions-resources-contextkeys.html">Actions, resources, and condition keys for AWS services - Service Authorization Reference</a></p>
</li>
</ul>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_condition_operators.html">IAM JSON policy elements: Condition operators - AWS Identity and Access Management</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html">AWS global condition context keys - AWS Identity and Access Management</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_principal.html">AWS JSON policy elements: Principal - AWS Identity and Access Management</a></p>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/AWS/" rel="tag"># AWS</a>
              <a href="/blog/tags/IAM/" rel="tag"># IAM</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/AWS/learn-AWS-IAM-1-user-group-credential/" rel="prev" title="[AWS IAM] 學習重點節錄(1) - IAM Uer & Group、Credential">
                  <i class="fa fa-chevron-left"></i> [AWS IAM] 學習重點節錄(1) - IAM Uer & Group、Credential
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/AWS/learn-AWS-IAM-3-assuming-role/" rel="next" title="[AWS IAM] 學習重點節錄(3) - Assuming IAM Role">
                  [AWS IAM] 學習重點節錄(3) - Assuming IAM Role <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  



      
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">godleon</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
<script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/schemes/muse.js"></script><script src="/blog/js/next-boot.js"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  















  








    <div class="pjax">
  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://godleon-blog-hexo.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://godleon.github.io/blog/AWS/learn-AWS-IAM-2-policy/";
    this.page.identifier = "AWS/learn-AWS-IAM-2-policy/";
    this.page.title = "[AWS IAM] 學習重點節錄(2) - IAM Policy";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://godleon-blog-hexo.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

    </div>
</body>
</html>
